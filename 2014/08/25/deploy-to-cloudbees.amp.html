<!DOCTYPE html>
<html amp lang="en">
  <head>

    <meta charset="utf-8">
    <title>How to Deploy to CloudBees, in One Click</title>
    <link rel="canonical" href="https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html"
        },
        "headline": "How to Deploy to CloudBees, in One Click",
        "image": {
          "@type": "ImageObject",
          "url": "https://www.yegor256.com/images/face-1200x1200.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2014-08-25",
        "dateModified": "2014-08-25",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "This tutorial explains how a Java web application can be
deployed to CloudBees in just one click and
zero maintenance efforts, using Rultor.com, DevOps assistant
",
        "keywords": ["deploy to cloudbees", "how to host java web app", "how to deploy a java app to cloudbees", "deploying to cloudbees", "deploy in cloudbees", "publish java web app to cloudbees", "continuous delivery cloudbees"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
<noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500">
    <style amp-custom="amp-custom">
      @font-face {
        font-family: 'Cambria';
        src: url('https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf');
      }
      body { font-family: 'Cambria', 'Times New Roman', serif; padding: .5em; font-size: 1.2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
      pre, code { font-family: 'Source Code Pro', 'Courier New', monospace; font-size: .8em; }
      code { padding: 0 .3em; background-color: lightgray; }
      a, a:hover, a:visited { color: inherit; }
      .intro { color: red; font-size: .75em; }
      .photo { border-radius: 50%; }
      pre { overflow-x:scroll; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <p class="intro">
        This is a mobile version, full one is
        <a href="https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html">here</a>.
      </p>
      <p>
        <amp-img src="/images/face-256x256.jpg" width="80" height="80" alt="Yegor Bugayenko" class="photo"></amp-img>
      </p>
      <p>Yegor Bugayenko<br>25 August 2014</p>
      <h1>How to Deploy to CloudBees, in One Click</h1>
      <p>When I deploy a new version of <a href="http://www.stateful.co">stateful.co</a>,
a Java web application, to CloudBees, it takes 30 seconds of my time.
Maybe even less. Recently, I deployed version 1.6.5. You can see
how it all happened, in <a href="https://github.com/sttc/stateful/issues/6">GitHub issue #6</a>:</p>



<p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>,
and it packaged, tested and deployed a new version to CloudBees.
I didn’t do anything else.</p>

<p>Now let’s see how you can do the same. How you can configure your project
so that the deployment of its new version to CloudBees
takes just a few seconds of your time.</p>



<p>
Since CloudBees is
<a href="http://www.cloudbees.com/press/cloudbees-becomes-enterprise-jenkins-company">shutting down its PaaS service</a>
by the end of December, 2014,
this article will have no sense after that.
</p>

<h2 id="configure-the-cloudbees-maven-plugin">Configure the CloudBees Maven Plugin</h2>

<p>Add this profile to your <code class="highlighter-rouge">pom.xml</code>:</p>

<pre>&lt;project&gt;
  [..]
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;cloudbees&lt;/id&gt;
      &lt;activation&gt;
        &lt;property&gt;&lt;name&gt;bees.appId&lt;/name&gt;&lt;/property&gt;
      &lt;/activation&gt;
      &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
          &lt;id&gt;cloudbees-public-release&lt;/id&gt;
          &lt;url&gt;
            http://repository-cloudbees.forge.cloudbees.com/public-release
          &lt;/url&gt;
        &lt;/pluginRepository&gt;
      &lt;/pluginRepositories&gt;
      &lt;build&gt;
        &lt;pluginManagement&gt;
          &lt;plugins&gt;
            &lt;plugin&gt;
              &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
              &lt;configuration&gt;
                  &lt;skip&gt;true&lt;/skip&gt;
              &lt;/configuration&gt;
            &lt;/plugin&gt;
          &lt;/plugins&gt;
        &lt;/pluginManagement&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;com.cloudbees&lt;/groupId&gt;
            &lt;artifactId&gt;bees-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.3.2&lt;/version&gt;
            &lt;configuration&gt;
              &lt;appid&gt;${bees.id}&lt;/appid&gt;
              &lt;apikey&gt;${bees.key}&lt;/apikey&gt;
              &lt;secret&gt;${bees.secret}&lt;/secret&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;deploy-to-production&lt;/id&gt;
                &lt;phase&gt;deploy&lt;/phase&gt;
                &lt;goals&gt;
                  &lt;goal&gt;deploy&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/project&gt;</pre>

<p>This plugin is not in Maven Central (unfortunately). That’s why
we have to specify that <code class="highlighter-rouge">&lt;pluginRepository&gt;</code>.</p>

<p>Pay attention to the fact that we’re also disabling <code class="highlighter-rouge">maven-deploy-plugin</code>, since
it would try to deploy your WAR package to the repository from the
<code class="highlighter-rouge">&lt;distributionManagement&gt;</code> section. We want to avoid this.</p>

<p>The profile gets activated only when the <code class="highlighter-rouge">bees.id</code> property
is defined. This won’t happen during your normal development and testing,
but it will occur during the deployment cycle initiated by Rultor, because
we will define this property in <code class="highlighter-rouge">settings.xml</code> (discussed below).</p>

<h2 id="secure-access-to-cloudbees">Secure Access to CloudBees</h2>

<p>Create an account in CloudBees and register your web application there.
CloudBees is free, as long as you don’t need too much computing power. I believe
that web applications should be light-weight by definition, so CloudBees’ free
layer is an ideal choice.</p>

<p>Create a <code class="highlighter-rouge">settings.xml</code> file (but don’t commit it to your repo!):</p>

<pre>&lt;settings&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;cloudbees&lt;/id&gt;
      &lt;properties&gt;
        &lt;bees.id&gt;stateful/web&lt;/bees.id&gt;
        &lt;bees.key&gt;&lt;!-- your key --&gt;&lt;/bees.key&gt;
        &lt;bees.secret&gt;&lt;!-- your secret --&gt;&lt;/bees.secret&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/settings&gt;</pre>

<p>Encrypt this file using <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p>

<pre>$ gem install rultor
$ rultor encrypt -p me/test settings.xml</pre>

<p>Instead of <code class="highlighter-rouge">me/test</code> use the name of your GitHub project.</p>

<p>You should get a <code class="highlighter-rouge">settings.xml.asc</code> file; add it to the root directory
of your project, commit and push. This file contains your CloudBees
credentials, but in an encrypted format. Nobody can read it, except the
Rultor server.</p>

<h2 id="configure-versions-plugin">Configure Versions Plugin</h2>

<p>I recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">jcabi-parent</a>.
It configures the required plugin out-of-the-box.
If you’re using it, skip this step.</p>

<p>Otherwise, add this plugin to your <code class="highlighter-rouge">pom.xml</code>:</p>

<pre>&lt;project&gt;
  [..]
  &lt;build&gt;
    [..]
    &lt;plugins&gt;
      [..]
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;versions-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;generateBackupPoms&gt;false&lt;/generateBackupPoms&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre>

<h2 id="configure-rultor">Configure Rultor</h2>

<p>Create a <code class="highlighter-rouge">.rultor.yml</code> file in the root directory of your project
(this <a href="https://doc.rultor.com/reference.html">reference page</a>
explains this format in detail):</p>

<pre>decrypt:
  settings.xml: "repo/settings.xml.asc"
release:
  script: |
    mvn versions:set "-DnewVersion=${tag}"
    git commit -am "${tag}"
    mvn clean deploy --settings /home/r/settings.xml</pre>

<p>You can compare your file with live Rultor
<a href="https://github.com/sttc/stateful/blob/master/.rultor.yml">configuration of stateful.co</a>.</p>

<h2 id="run-it">Run It!</h2>



<p>Now it’s time to see how it all works. Create a new ticket in the
GitHub issue tracker, and post something like that into it
(read more about <a href="https://doc.rultor.com/basics.html">Rultor commands</a>):</p>

<pre>@rultor release, tag is `0.1`</pre>

<p>You will get a response in a few seconds. The rest will be done by Rultor.</p>

<p>Enjoy :)</p>

<p>BTW, if something doesn’t work as I’ve explained, don’t hesitate to
submit a ticket to the
<a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>.
I will try to help you.</p>

<p>Also, a similar configuration can be performed
for <a href="/2014/09/13/deploying-to-heroku.html">Heroku</a>
(using <a href="http://heroku.jcabi.com">jcabi-heroku-maven-plugin</a>)
and for AWS Elastic Beanstalk (using <a href="http://beanstalk.jcabi.com">jcabi-beanstalk-maven-plugin</a>).
I’ll probably dedicate individual posts to them, as well.</p>

    </article>
  </body>
</html>
