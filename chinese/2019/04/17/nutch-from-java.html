<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Nutch is an open source framework for crawling web content, however it is designed primarily to be used from the command line; here I explain how to use it from inside Java." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Use Nutch From Java, Not From the Command Line"/> <meta name="twitter:description" property="og:description" content="Nutch is an open source framework for crawling web content, however it is designed primarily to be used from the command line; here I explain how to use it from inside Java."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/chinese/2019/04/17/nutch-from-java.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="apple-touch-icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?3a3b5d6c83f"/> <link rel="stylesheet" href="/css/icons.css?3a3b5d6c83f"/> <link rel="canonical" href="https://www.yegor256.com/chinese/2019/04/17/nutch-from-java.html" /> <title>How to Use Nutch From Java, Not From the Command Line</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">How to Use Nutch From Java, Not From the Command Line</h1></header> <article class="main" itemprop="articleBody"><p style="color: #C42C00;">The following text is a translation of the <a href='https://www.yegor256.com/2019/04/17/nutch-from-java.html'>original article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo):</p><p>Apache Nutch est un framework open source écrit en Java. Son but est de nous aider à parcourir un ensemble de sites Web (ou l’ensemble d’Internet), récupérer le contenu et le préparer pour l’indexation, par exemple avec Solr. Un framework assez utile, si vous me le demandez, cependant il est conçu pour être utilisé principalement en HTML à partir de la ligne de commande. Vous téléchargez l’archive, la décompressez et exécutez le fichier binaire. Il parcourt et vous obtenez les données. Cependant, j’ai un projet où ce parcours devait être intégré à mon application Java. J’ai réalisé qu’il n’y avait aucune documentation complète à ce sujet. D’où ce billet de blog. Il explique comment vous pouvez utiliser Nutch depuis Java, et non depuis la ligne de commande.</p><p>Je vais parler de Nutch 1.15. Il existe une version plus récente, la version 2+, mais je n’ai pas réussi à la faire fonctionner. Si vous savez comment faire, laissez votre commentaire ci-dessous.</p><p>Je vous recommande de lire ce tutoriel en premier, afin de comprendre comment Nutch fonctionne en ligne de commande. Eh bien, ça m’a aidé en tout cas.</p><p>Maintenant, voyons comment nous pouvons utiliser Nutch sans la ligne de commande. Tout d’abord, vous avez besoin de ces dépendances dans votre pom.xml (Nutch utilise Apache Hadoop, c’est pourquoi nous avons besoin de la deuxième dépendance) :</p><p>xml</p><project> <dependencies> <dependency> <groupId>org.apache.nutch</groupId> <artifactId>nutch</artifactId> <version>1.15</version> </dependency> <dependency> <groupId>org.apache.hadoop</groupId> <artifactId>hadoop-common</artifactId> <version>2.7.2</version> </dependency> [...] </dependencies> [...] </project><p>Suivant, voici votre code Java, qui effectue tout le travail :</p><p>java import java.io.IOException; import java.nio.file.Files; import java.nio.file.Paths; import java.util.Collection; import java.util.Collections; import java.util.Comparator; import java.util.List; import java.util.stream.Collectors; import org.apache.commons.io.FileUtils; import org.apache.hadoop.conf.Configuration; import org.apache.nutch.crawl.CrawlDb; import org.apache.nutch.crawl.Generator; import org.apache.nutch.crawl.Injector; import org.apache.nutch.fetcher.Fetcher; import org.apache.nutch.parse.ParseSegment; import org.apache.nutch.tools.FileDumper; public class Main { public static void main(String… args) throws Exception { // Create a default configuration object, which will read // the content of nutch-default.xml file from the classpath, // parse it and take its entire content as the default // configuration. Funny, but this interface is from Hadoop: Configuration conf = NutchConfiguration.create(); // Now it’s possible to reset some configuration parameters // by using this set() method. This one is mandatory, if you // don’t set it the crawling won’t work. The value is used // as User-Agent HTTP header. conf.set(“http.agent.name”, “me, myself, and I”); // This one is also mandatory and we will discuss its // value below. You need to point Nutch to the directory // with compiled plugins and this collection is NOT in // its default JAR package, unfortunately. conf.set(“plugin.folders”, System.getProperty(“nutch.plugins.dir”)); // First, we need to have a directory where everything will // happen. I assume you are familiar with Maven, so let’s use // its default temporary directory “target”: Path home = new Path(“target”); // Next, we have to create a file with a list of URLs Nutch will // start crawling from: String[] urls = { “http://www.zerocracy.com” }; final Path targets = new Path(home, “urls”); Files.createDirectory(Paths.get(targets.toString())); Files.write( Paths.get(targets.toString(), “list-of-urls.txt”), String.join(“\n”, urls).getBytes() ); // Next, we have to point Nutch to the directory with the // text file and let it “inject” our URLs into its database: new Injector(conf).inject( new Path(home, “crawldb”), // the directory with its database new Path(home, “urls”), // the directory with text files with URLs true, true // no idea what this is ); // Now, it’s time to do a few cycles of fetching, parsing, and // updating. This is how Nutch works, in increments. Each increment // will bring new web pages to the database. The more increments // you run, the deeper Nutch will go into the Internet. Five here // is a very small number. If you really want to crawl deeper, // you will need hundreds of increments. I guess, anyway. I haven’t tried it. for (int idx = 0; idx &lt; 5; ++idx) { this.cycle(home, conf); } // Now it’s time to dump what is fetched to a new directory, // which will contain HTML pages and all other files when // finished. Files.createDirectory(Paths.get(new Path(home, “dump”).toString())); new FileDumper().dump( new File(new Path(home, “dump”).toString()), // where to dump new File(new Path(home, “segments”).toString()), null, true, false, true ); } private void cycle(Path home, Configuration conf) { // This is the directory with “segments”. Each fetching cycle // will produce its own collection of files. Each collection // is called a segment. final Path segments = new Path(home, “segments”); // First, we generate a list of target URLs to fetch from: new Generator(conf).generate( new Path(home, “crawldb”), new Path(home, “segments”), 1, 1000L, System.currentTimeMillis() ); // Then, we get the path of the current segment: final Path sgmt = Batch.segment(segments); // Then, we fetch, parse and update: new Fetcher(conf).fetch(sgmt, 10); new ParseSegment(conf).parse(sgmt); new CrawlDb(conf).update( new Path(home, “crawldb”), Files.list(Paths.get(segments.toString())) .map(p -&gt; new Path(p.toString())) .toArray(Path[]::new), true, true ); } private static Path segment(final Path dir) throws IOException { // Get the path of the most recent segment in the list, // sorted by the date/time of their creation. final List<Path> list = Files.list(Paths.get(dir.toString())) .map(p -&gt; new Path(p.toString())) .sorted(Comparator.comparing(Path::toString)) .collect(Collectors.toList()); return list.get(list.size() - 1); } }</Path></p><p>Faites attention que le chemin ici n’est pas le chemin du JDK. C’est le chemin de Hadoop. Ne me demandez pas pourquoi.</p><p>Cela semble être un algorithme assez simple, cependant il y a une partie délicate. Nutch, pour fonctionner, a besoin de plusieurs plugins qui sont des packages JAR autonomes, qui ne sont pas inclus dans son JAR par défaut. Ils existent dans sa distribution binaire et ils sont assez volumineux (plus de 250 Mo dans Nutch 1.15). Nutch s’attend à ce que vous téléchargiez l’ensemble de la distribution, la décompiliez et exécutiez le fichier binaire nutch qu’ils fournissent, qui fonctionnera avec les plugins fournis.</p><p>Que pouvons-nous faire maintenant que nous sommes à Java, et non dans la ligne de commande? Voici ce que je suggère:</p><p>xml</p><project> <build><plugins><plugin> <groupId>com.googlecode.maven-download-plugin</groupId> <artifactId>download-maven-plugin</artifactId> <version>1.4.1</version> <executions> <execution> <id>download-nutch</id><phase>generate-resources</phase> <goals> <goal>wget</goal> </goals> <configuration> <url>http://artfiles.org/apache.org/nutch/1.15/apache-nutch-1.15-bin.zip</url> <unpack>true</unpack> <outputDirectory>${project.build.directory}</outputDirectory> <overwrite>false</overwrite> </configuration> </execution> </executions> </plugin> </plugins> </build> [...] </project><p>Ce plugin Maven téléchargera la distribution binaire complète de Nutch et la décompressera dans target/apache-nutch-1.15. Les plugins seront situés dans target/apache-nutch-1.15/plugins. La seule chose qu’il nous reste à faire est de définir la propriété système pour le test unitaire.</p><p>xml</p><projet> <construction> <gestionDuPlugin><plugins><plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-surefire-plugin</artifactId> <configuration> <variablesDePropriétésSystème> <nutch.plugins.dir>${project.build.directory}/apache-nutch-1.15/plugins</nutch.plugins.dir> </variablesDePropriétésSystème> </configuration> </plugin> </plugins> </gestionDuPlugin> [...] </construction> [...] </projet><p>En fait, une autre chose que nous devons faire: copier le contenu du répertoire conf de leur distribution binaire vers notre répertoire src/main/resources. Il y a de nombreux fichiers, y compris le fichier le plus important nutch-default.xml. Ils doivent tous être disponibles sur le classpath, sinon Nutch se plaindra à de nombreux endroits et ne pourra pas charger la Configuration.</p><p>Vous pouvez voir comment tout cela fonctionne ensemble dans ce référentiel GitHub que j’ai créé pour illustrer l’exemple : yegor256/nutch-in-java.</p><p>Si vous avez des questions ou des suggestions, n’hésitez pas à soumettre une demande de tirage ou à commenter ici.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/0.0.14</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?3a3b5d6c83f"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
