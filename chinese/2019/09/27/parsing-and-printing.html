<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Printing and parsing dates in Java is the territory of horror, with dozens of libraries, which don't make life easier; there is an elegant solution, however." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Date/Time Printing Can Be Elegant Too"/> <meta name="twitter:description" property="og:description" content="Printing and parsing dates in Java is the territory of horror, with dozens of libraries, which don't make life easier; there is an elegant solution, however."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/chinese/2019/09/27/parsing-and-printing.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="apple-touch-icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?3a3b5d6c83f"/> <link rel="stylesheet" href="/css/icons.css?3a3b5d6c83f"/> <link rel="canonical" href="https://www.yegor256.com/chinese/2019/09/27/parsing-and-printing.html" /> <title>Date/Time Printing Can Be Elegant Too</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Date/Time Printing Can Be Elegant Too</h1></header> <article class="main" itemprop="articleBody"><p style="color: #C42C00;">The following text is a translation of the <a href='https://www.yegor256.com/2019/09/27/parsing-and-printing.html'>original article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo):</p><p>Je dois ma assez haute réputation sur Stack Overflow à cette question en particulier, que j’ai posée il y a quelques années : Comment imprimer une date ISO 8601 en Java ? Elle a réussi à collecter de nombreux votes positifs depuis lors et plus de 20 réponses, y compris la mienne. Sérieusement, pourquoi Java, un écosystème aussi riche, n’avait-il pas de solution simple intégrée pour cette tâche primitive ? Je pense que cela s’explique par le fait que les concepteurs de la SDK Java étaient 1) assez intelligents pour ne pas créer une méthode print() directement dans la classe Date, et 2) pas assez intelligents pour nous fournir un ensemble extensible de classes et d’interfaces pour analyser et imprimer des dates de manière élégante.</p><p>Il existe essentiellement trois façons de répartir la responsabilité de l’analyse et de l’impression dans JDK (à ma connaissance) :</p><p>Le premier est lorsque quelque chose est responsable de l’impression et de l’analyse alors que l’objet est simplement un conteneur de données. Il existe une classe SimpleDateFormat, qui doit d’abord être configurée avec le bon fuseau horaire et le modèle de formatage. Ensuite, il doit être utilisé pour l’impression :</p><p>java DateFormat df = new SimpleDateFormat(“yyyy-MM-dd’T’HH:mm’Z’”); df.setTimeZone(TimeZone.getTimeZone(“UTC”)); String iso = df.format(new Date());</p><p>Pour le retransformer, il y a la méthode parse().</p><p>java Date date = df.parse(“2007-12-03T10:15Z”);</p><p>C’est une combinaison classique d’une DTO et d’une classe utilitaire. La DTO est l’objet Date et la classe utilitaire est SimpleDateFormat. L’objet date expose toutes les propriétés de données requises via plusieurs accesseurs et la classe utilitaire imprime la date. L’objet date n’a aucune influence sur ce processus. Ce n’est pas vraiment un objet, mais simplement un conteneur de données. Ce n’est pas de la programmation orientée objet du tout.</p><p>Java 8 a introduit la classe Instant avec la méthode toString(), qui renvoie l’heure au format ISO-8601 :</p><p>java Chaîne iso = Instant.now().toString();</p><p>Pour le reconstituer, il existe une méthode statique parse() dans la même classe instant.</p><p>java Instant time = Instant.parse(“2007-12-03T10:15:30Z”);</p><p>Cette approche semble plus orientée objet, mais le problème ici est qu’il est impossible de modifier le motif d’impression de quelque manière que ce soit (par exemple, supprimer les millisecondes ou changer le format complètement). De plus, la méthode parse() est statique, ce qui signifie qu’il ne peut y avoir aucune polymorphie - nous ne pouvons pas changer la logique de l’analyse non plus. Nous ne pouvons pas non plus changer la logique d’impression, car Instant est une classe finale, pas une interface.</p><p>Ce design semble correct si tout ce dont nous avons besoin sont des chaînes de date/heure ISO 8601. Dès que nous décidons de l’étendre d’une certaine manière, nous sommes en difficulté.</p><p>Il y a aussi DateTimeFormatter en Java 8, qui introduit la troisième façon de gérer les objets de date/heure. Pour imprimer une date dans une chaîne de caractères, nous créons une instance du “formatter” et la passons à l’objet temps.</p><p>java LocalDateTime date = LocalDateTime.now(ZoneId.of(“UTC”)); DateTimeFormatter formatter = DateTimeFormatter.ofPattern( “yyyy-MM-dd’T’HH:mm:ss’Z’” ); String iso = time.format(formatter);</p><p>Pour analyser à nouveau, nous devons envoyer le formateur à la méthode statique parse() ainsi que le texte à analyser.</p><p>java LocalDateTime time = LocalDateTime.parse( “2007-12-03T10:15:30Z”, formatter );</p><p>Comment communiquent LocalDateTime et DateTimeFormatter ? L’objet de temps est un TemporalAccessor, avec une méthode get() permettant à quiconque d’extraire ce qui se trouve à l’intérieur. En d’autres termes, encore une fois, un DTO. Le formateur est toujours une classe utilitaire (pas même une interface), qui attend que le DTO arrive, extrait ce qui se trouve à l’intérieur et imprime.</p><p>Comment sont-ils analysés? La méthode parse() lit le modèle et construit et renvoie un autre DTO TemporalAccessor .</p><p>Que dire de l’encapsulation ? “Pas cette fois-ci,” disent les concepteurs du JDK.</p><p>Voici comment je le concevrais à la place. Tout d’abord, je créerais un modèle générique immuable avec cette interface :</p><p>java interface Template { Template with(String key, Object value); Object read(String key); }</p><p>It would be used like this:</p><p>java Chaîne iso = new DefaultTemplate(“yyyy-MM-dd’T’HH:mm’Z’”) .with(“yyyy”, 2007) .with(“MM”, 12) .with(“dd”, 03) .with(“HH”, 10) .with(“mm”, 15) .with(“ss”, 30) .toString(); // renvoie “2007-12-03T10:15Z”</p><p>Ce modèle décide en interne comment imprimer les données qui arrivent, en fonction du motif encapsulé. Voici comment la Date serait en mesure de s’imprimer elle-même :</p><p>java classe Date { private final int annee; private final int mois; private final int jour; private final int heures; private final int minutes; private final int secondes; Template imprimer(Template template) { return template .avec(“yyyy”, this.annee) .avec(“MM”, this.mois) .avec(“dd”, this.jour) .avec(“HH”, this.heures) .avec(“mm”, this.minutes) .avec(“ss”, this.secondes); } }</p><p>C’est ainsi que l’analyse fonctionnerait (c’est une mauvaise idée en général de mettre du code dans le constructeur, mais pour cette expérience c’est OK):</p><p>java classe Date { private final int year; private final int month; private final int day; private final int hours; private final int minutes; private final int seconds; Date(Template template) { this.year = template.read(“yyyy”); this.month = template.read(“MM”); this.day = template.read(“dd”); this.hours = template.read(“HH”); this.minutes = template.read(“mm”); this.seconds = template.read(“ss”); } }</p><p>Допустим, мы хотим напечатать время как “13-е января 2019 года” (это на русском языке). Как мы бы это сделали? Мы не создаем новый шаблон, мы украшаем уже существующий, несколько раз. Сначала мы создаем экземпляр того, что у нас уже есть:</p><p>java new DefaultTemplate(“dd-th MMMM yyyy”)</p><p>Cela imprimera quelque chose comme ceci:</p><p>text 12-е MMMM 2019-го года</p><p>La date n’envoie pas la valeur de MMMM en elle, c’est pourquoi elle ne remplace pas correctement le texte. Nous devons la décorer :</p><p>java class RussianTemplate { private final Template origin; RussianTemplate(Template t) { this.origin = t; } @Override Template with(String key, Object value) { Template t = this.origin.with(key, value); if (key.equals(“MM”)) { String name = “”; switch (value) { case 0: name = “января”; break; case 1: name = “февраля”; break; // etc… } t = t.with(“MMMM”, name); } return t; } }</p><p>Now, to get a Russian date from a Date object we do this:</p><p>java String txt = time.print( new RussianTemplate( new DefaultTemplate(“dd-е MMMM yyyy-го года”) ) );</p><p>Disons que nous voulons imprimer la date dans un fuseau horaire différent. Nous créons un autre décorateur, qui intercepte l’appel avec “HH” et déduit (ou ajoute) la différence de temps.</p><p>S’il vous plaît, traduisez ce paragraphe de l’anglais en français, sans modifier les noms propres :</p><p>java classe TimezoneTemplate { privé final Template origin; privé final int zone; TimezoneTemplate(Template t, int z) { this.origin = t; this.zone = z; } @Override Template with(String key, Object value) { Template t = this.origin.with(key, value); if (key.equals(“HH”)) { t = t.with(“MM”, Integer.cast(value) + this.z); } return t; } }</p><p>This code will print Moscow (UTC+3) time in Russian:</p><p>java String txt = time.print( new TimezoneTemplate( new RussianTemplate( new DefaultTemplate(“dd-е MMMM yyyy-го года”) ), +3 ) );</p><p>Nous pouvons décorer autant que nécessaire, rendant le Template aussi puissant qu’il doit l’être. L’élégance de cette approche est que la classe Date est complètement désolidarisée du Template, ce qui les rend à la fois interchangeables et polymorphes.</p><p>Peut-être que quelqu’un sera intéressé à créer une bibliothèque d’impression et d’analyse de date et d’heure en open source pour Java en gardant ces principes à l’esprit ?</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/0.0.14</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?3a3b5d6c83f"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
