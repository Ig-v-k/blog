<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Dependency Injection Containers are Code Polluters"/> <meta name="twitter:description" property="og:description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/chinese/2014/10/03/di-containers-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="apple-touch-icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?3a3b5d6c83f"/> <link rel="stylesheet" href="/css/icons.css?3a3b5d6c83f"/> <link rel="canonical" href="https://www.yegor256.com/chinese/2014/10/03/di-containers-are-evil.html" /> <title>Dependency Injection Containers are Code Polluters</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Dependency Injection Containers are Code Polluters</h1></header> <article class="main" itemprop="articleBody"><p style="color: #C42C00;">The following text is a translation of the <a href='https://www.yegor256.com/2014/10/03/di-containers-are-evil.html'>original article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo):</p><p>Alors que l’injection de dépendances (aka “DI”) est une technique naturelle de composition d’objets en POO (connue bien avant que le terme ne soit introduit par Martin Fowler), Spring IoC, Google Guice, Java EE6 CDI, Dagger et d’autres frameworks DI en font une anti-patern.</p><p>Je ne vais pas discuter des arguments évidents contre les “setter injections” (comme dans Spring IoC) et les “field injections” (comme dans PicoContainer). Ces mécanismes violent simplement les principes fondamentaux de la programmation orientée objet et nous encouragent à créer des objets incomplets et mutables, qui sont remplis de données pendant l’exécution de l’application. Rappelez-vous : les objets idéaux doivent être immuables et ne doivent pas contenir de setters.</p><p>Au lieu de cela, parlons de “l’injection de constructeur” (comme dans Google Guice) et de son utilisation avec les conteneurs d’injection de dépendances. J’essaierai de montrer pourquoi je considère ces conteneurs comme une redondance, au moins.</p><p>Ceci est ce qu’est l’injection de dépendances (pas vraiment différente de la simple composition d’objets classiques).</p><p>java public class Budget { private final DB db; public Budget(DB data) { this.db = data; } public long total() { return this.db.cell( “SELECT SUM(cost) FROM ledger” ); } }</p><p>Les données de l’objet sont appelées une “dépendance”.</p><p>Un budget ne sait pas quel type de base de données il utilise. Tout ce dont il a besoin de la base de données est sa capacité à récupérer une cellule, en utilisant une requête SQL arbitraire, via la méthode cell(). Nous pouvons instancier un budget avec une implémentation PostgreSQL de l’interface DB, par exemple:</p><p>java public class App { public static void main(String… args) { Budget budget = new Budget( new Postgres(“jdbc:postgresql:5740/main”) ); System.out.println(“Total is: “ + budget.total()); } }</p><p>En d’autres termes, nous “injectons” une dépendance dans un nouveau budget d’objet.</p><p>Une alternative à cette approche de “injection de dépendance” serait de laisser Budget décider avec quelle base de données il souhaite travailler.</p><p>s’il vous plaît, traduisez ce paragraphe de l’anglais à l’anglais, sans changer les noms propres:</p><p>java public class Budget { private final DB db = new Postgres(“jdbc:postgresql:5740/main”); // méthodes de classe }</p><p>Ceci est très sale et conduit à 1) la duplication de code, 2) l’incapacité à réutiliser, et 3) l’incapacité à tester, etc. Pas besoin de discuter pourquoi. C’est évident.</p><p>Ainsi, l’injection de dépendance via un constructeur est une technique incroyable. Eh bien, pas seulement une technique, en réalité. Plus comme une fonctionnalité de Java et de tous les autres langages orientés objet. Il est attendu que presque tout objet souhaite encapsuler une certaine connaissance (alias un “état”). C’est à cela que servent les constructeurs.</p><p>Jusqu’à présent, tout va bien, mais voici venir le côté sombre - un conteneur d’injection de dépendances. Voici comment cela fonctionne (prenons Google Guice comme exemple):</p><p>java import javax.inject.Inject; public class Budget { private final DB db; @Inject public Budget(DB data) { this.db = data; } // same methods as above }</p><p>Payez attention: le constructeur est annoté avec @Inject.</p><p>Ensuite, nous sommes censés configurer un conteneur quelque part lorsque l’application démarre.</p><p>java Injector injector = Guice.createInjector( new AbstractModule() { @Override public void configure() { this.bind(DB.class).toInstance( new Postgres(“jdbc:postgresql:5740/main”) ); } } );</p><p>Certains frameworks nous permettent même de configurer l’injecteur dans un fichier XML.</p><p>From now on, we are not allowed to instantiate Budget through the new operator, like we did before. Instead, we should use the injector we just created:</p><p>java public class App { public static void main(String… args) { Injection injector = // as we just did in the previous snippet Budget budget = injector.getInstance(Budget.class); System.out.println(“Total is: “ + budget.total()); } }</p><p>La injection découvre automatiquement que pour instancier un Budget, elle doit fournir un argument pour son constructeur. Elle utilisera une instance de la classe Postgres, que nous avons instanciée dans l’injecteur.</p><p>C’est la bonne façon recommandée d’utiliser Guice. Cependant, il existe quelques motifs encore plus sombres, qui sont possibles mais non recommandés. Par exemple, vous pouvez rendre votre injecteur un singleton et l’utiliser directement à l’intérieur de la classe Budget. Cependant, ces mécanismes sont considérés comme incorrects même par les créateurs de conteneurs DI. Ignorons-les et concentrons-nous sur le scénario recommandé.</p><p>Laissez-moi réitérer et résumer les scénarios d’utilisation incorrecte des conteneurs d’injection de dépendances.</p><p>Field injection</p><p>Setter injection</p><p>Passing injector as a dependency</p><p>Faire de l’injecteur un singleton mondial.</p><p>Si nous mettons tous ces éléments de côté, tout ce qu’il nous reste est l’injection de constructeur expliquée ci-dessus. Et comment cela nous aide-t-il ? Pourquoi en avons-nous besoin ? Pourquoi ne pouvons-nous pas utiliser simplement le bon vieux “new” dans la classe principale de l’application ?</p><p>Le conteneur que nous avons créé ajoute simplement plus de lignes à la base de code, ou même plus de fichiers, si nous utilisons XML. Et cela n’ajoute rien, sauf une complexité supplémentaire. Nous devrions toujours nous souvenir de cela si nous avons la question : “Quelle base de données est utilisée en tant qu’argument d’un Budget ?”</p><p>Maintenant, laissez-moi vous montrer un exemple concret d’utilisation de new pour construire une application. C’est ainsi que nous créons un “moteur de réflexion” sur rultor.com (la classe complète se trouve dans Agents.java):</p><script src="https://gist.github.com/c76c06baee1f74e3100e.js?file=Agents.java"> </script><p>Impressionnant? C’est une véritable composition d’objets. Je pense que c’est ainsi qu’une application orientée objet appropriée devrait être instanciée.</p><p>Et les conteneurs DI ? À mon avis, ils ajoutent simplement du bruit inutile.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/0.0.14</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?3a3b5d6c83f"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
