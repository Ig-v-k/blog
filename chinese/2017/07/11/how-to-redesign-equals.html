<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The design of equals() and compareTo() in Java is far from perfect; this is how I would improve it and make more object-oriented." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How I Would Re-design equals()"/> <meta name="twitter:description" property="og:description" content="The design of equals() and compareTo() in Java is far from perfect; this is how I would improve it and make more object-oriented."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/chinese/2017/07/11/how-to-redesign-equals.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="apple-touch-icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?3a3b5d6c83f"/> <link rel="stylesheet" href="/css/icons.css?3a3b5d6c83f"/> <link rel="canonical" href="https://www.yegor256.com/chinese/2017/07/11/how-to-redesign-equals.html" /> <title>How I Would Re-design equals()</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">How I Would Re-design equals()</h1></header> <article class="main" itemprop="articleBody"><p style="color: #C42C00;">The following text is a translation of the <a href='https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html'>original article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo):</p><p>Je veux me plaindre un peu du design de Java, en particulier des méthodes Object.equals() et Comparable.compareTo(). Je les ai détestées pendant des années, car peu importe à quel point j’essaie de les aimer, le code à l’intérieur semble laid. Maintenant, je sais exactement ce qui ne va pas et comment je concevrais ce mécanisme de “comparaison d’objet à objet” de manière meilleure.</p><p>Disons que nous avons une classe primitive HTMLsimpleHTML Weight, dont les objets représentent le poids de quelque chose en kilos.</p><p>java classe Poids { private int kilos; Poids(int k) { this.kilos = k; } }</p><p>Suivant, nous voulons que deux objets du même poids soient égaux l’un à l’autre.</p><p>java new Weight(15).equals(new Weight(15));</p><p>Voici à quoi une telle méthode peut ressembler :</p><p>java classe Poids { private int kilos; Poids(int k) { this.kilos = k; } public boolean equals(Object obj) { if (!(obj instanceof Poids)) { return false; } Poids poids = Poids.class.cast(obj); return poids.kilos == this.kilos; } }</p><p>La partie laide ici est, tout d’abord, la conversion de type avec instanceof. Le deuxième problème est que nous touchons les parties internes de l’objet entrant. Cette conception rend le comportement polymorphe du poids impossible. Nous ne pouvons tout simplement pas passer autre chose que une instance de la classe Weight à la méthode equals(). Nous ne pouvons pas le transformer en une interface et introduire plusieurs implémentations de celle-ci.</p><p>java interface Poids { boolean equals(Object obj); }</p><p>This code will not work:</p><p>java classe DefaultWeight implements Weight { // attribut et constructeur omis public boolean equals(Object obj) { if (!(obj instanceof Weight)) { return false; } Weight weight = Weight.class.cast(obj); return weight.kilos == this.kilos; // erreur ici! } }</p><p>Le problème est que l’un des objets décide de l’égalité de l’autre. Cela conduit inévitablement à la nécessité de toucher les attributs privés afin de réaliser la comparaison réelle.</p><p>What is the solution?</p><p>Voici ce que je propose. Toute comparaison, peu importe les types dont nous parlons, consiste à comparer deux valeurs numériques. Que ce soit une comparaison de poids avec un poids, de texte avec du texte, ou d’utilisateur avec un utilisateur, nos processeurs ne peuvent comparer que des nombres. Ainsi, nous introduisons une nouvelle interface, “Digitizable”.</p><p>java interface Digitizable { byte[] digits(); }</p><p>Ensuite, nous introduisons une nouvelle classe Comparison, qui est la comparaison de deux flux d’octets (Je ne suis pas sûr que le code soit parfait, je l’ai testé ici, n’hésitez pas à l’améliorer et à contribuer en soumettant une demande de tirage).</p><p>java class Comparison<T extends="" Digitizable=""> { private T lt; private T rt; Comparison(T left, T right) { this.lt = left; this.rt = right; } int value() { final byte[] left = this.lt.digits(); final byte[] right = this.rt.digits(); int result = 0; int max = Math.max(left.length, right.length); for (int idx = max; idx &gt; 0; --idx) { byte lft = 0; if (idx &lt;= left.length) { lft = left[max - idx]; } byte rht = 0; if (idx &lt;= right.length) { rht = right[max - idx]; } result = lft - rht; if (result != 0) { break; } } return (int) Math.signum(result); } }</T></p><p>Maintenant, nous avons besoin de Weight pour implémenter Digitizable:</p><p>s’il vous plaît, traduisez ce paragraphe de l’anglais en français, ne changez pas les noms propres :</p><p>java classe Poids implémente Digitizable { private int kilos; Poids(int k) { this.kilos = k; } @Override public byte[] chiffres() { return ByteBuffer.allocate(4) .putInt(this.kilos).array(); } }</p><p>Enfin, voici comment nous les comparons.</p><p>java int v = new Comparison<Weight>( new Weight(400), new Weight(500) ).value();</Weight></p><p>Ce v sera soit -1, 0, ou 1. Dans ce cas particulier, il sera -1, car 400 est inférieur à 500.</p><p>Plus de violation de l’encapsulation, plus de conversion de type, plus de code moche à l’intérieur de ces méthodes equals() et compareTo(). La classe Comparison fonctionnera avec tous les types possibles. Tout ce que nos objets doivent faire pour devenir comparables est de mettre en œuvre Digitizable et de “fournir” leurs octets pour inspection/comparaison.</p><p>Cette approche est en réalité très proche des imprimantes que j’ai décrites précédemment.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/0.0.14</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?3a3b5d6c83f"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
