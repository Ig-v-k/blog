<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Streams from Java 8 help us manipulate collections, but they ruin the idea of objects; decorators, on the other hand, do the same but in an object-oriented way." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Streams vs. Decorators"/> <meta name="twitter:description" property="og:description" content="Streams from Java 8 help us manipulate collections, but they ruin the idea of objects; decorators, on the other hand, do the same but in an object-oriented way."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/chinese/2017/10/10/streams-vs-decorators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="apple-touch-icon" href="/favicon.ico?3a3b5d6c83f"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?3a3b5d6c83f"/> <link rel="stylesheet" href="/css/icons.css?3a3b5d6c83f"/> <link rel="canonical" href="https://www.yegor256.com/chinese/2017/10/10/streams-vs-decorators.html" /> <title>Streams vs. Decorators</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Streams vs. Decorators</h1></header> <article class="main" itemprop="articleBody"><p style="color: #C42C00;">The following text is a translation of the <a href='https://www.yegor256.com/2017/10/10/streams-vs-decorators.html'>original article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo):</p><p>The Streams API a été introduit en Java 8, en même temps que les expressions lambda, il y a seulement quelques années. Moi, en tant que disciple discipliné de Java, j’ai essayé d’utiliser cette nouvelle fonctionnalité dans quelques-uns de mes projets, par exemple ici et ici. Je ne l’ai pas vraiment aimé et je suis revenu aux bons vieux décorateurs. De plus, j’ai créé Cactoos, une bibliothèque de décorateurs, pour remplacer Guava, qui n’est pas si bon dans de nombreux endroits.</p><p>Voici un exemple primitif. Disons que nous avons une collection de mesures provenant d’une source de données, ce sont tous des nombres entre zéro et un :</p><p>java Iterable<Double> probes;</Double></p><p>Now, we need to show only the first 10 of them, ignoring zeros and ones, and re-scaling them to (0..100). Sounds like an easy task, right? There are three ways to do it: procedural, object-oriented, and the Java 8 way. Let’s start with the procedural way.</p><p>java int pos = 0; for (Double probe : probes) { if (probe == 0.0d || probe == 1.0d) { continue; } if (++pos &gt; 10) { break; } System.out.printf( “Probe #%d: %f”, pos, probe * 100.0d ); }</p><p>Pourquoi est-ce une démarche procédurale ? Parce que c’est impératif. Pourquoi est-ce impératif ? Parce que c’est procédural. Nah, je plaisante.</p><p>C’est impératif car nous donnons des instructions à l’ordinateur sur quelles données mettre où et comment les itérer. Nous ne déclarons pas le résultat, mais nous le construisons de manière impérative. Cela fonctionne, mais ce n’est pas vraiment évolutif. Nous ne pouvons pas prendre une partie de cet algorithme et l’appliquer à un autre cas d’utilisation. Nous ne pouvons pas le modifier facilement, par exemple pour prendre des nombres provenant de deux sources au lieu d’une seule, etc. C’est procédural. Assez dit. Ne le faites pas de cette façon.</p><p>Maintenant, Java 8 nous offre l’API Streams, qui est censée offrir une manière fonctionnelle de faire la même chose. Essayons de l’utiliser.</p><p>Tout d’abord, nous devons créer une instance de Stream, que Iterable ne nous permet pas d’obtenir directement. Ensuite, nous utilisons l’API de flux pour faire le travail.</p><p>java StreamSupport.stream(probes.spliterator(), false) .filter(p -&gt; p == 0.0d || p == 1.0d) .limit(10L) .forEach( probe -&gt; System.out.printf( “Probe #%d: %f”, 0, probe * 100.0d ) );</p><p>Cela fonctionnera, mais affichera Probe #0 pour toutes les sondes, car forEach() ne fonctionne pas avec les index. Il n’y a pas de forEachWithIndex() dans l’interface Stream à partir de Java 8 (et Java 9 également). Voici une solution de contournement avec un compteur atomique :</p><p>java AtomicInteger index = new AtomicInteger(); StreamSupport.stream(probes.spliterator(), false) .filter(probe -&gt; probe != 0.0d &amp;&amp; probe != 1.0d) .limit(10L) .forEach( probe -&gt; System.out.printf( “Probe #%d: %f”, index.getAndIncrement(), probe * 100.0d ) );</p><p>“Qu’est-ce qui ne va pas avec ça?” pourriez-vous demander. Tout d’abord, voyez à quel point nous avons facilement eu des problèmes lorsque nous n’avons pas trouvé la bonne méthode dans l’interface Stream. Nous sommes immédiatement sortis du paradigme du “streaming” et sommes revenus à la bonne vieille variable globale procédurale (le compteur). Deuxièmement, nous ne voyons pas vraiment ce qui se passe à l’intérieur de ces méthodes filter(), limit() et forEach(). Comment fonctionnent-elles exactement ? La documentation indique que cette approche est “déclarative” et que chaque méthode de l’interface Stream renvoie une instance d’une classe. Quelles classes sont-elles ? Nous n’en avons aucune idée en regardant simplement ce code.</p><p>Ces deux problèmes sont liés. Le plus gros souci avec cette API de streaming est l’interface Stream elle-même - elle est énorme. Au moment de la rédaction, il y a 43 méthodes. Quarante-trois, dans une seule interface ! Cela va à l’encontre de chaque principe de la programmation orientée objet, commençant par SOLID et allant ensuite vers des principes plus sérieux.</p><p>Quelle est la manière orientée objet d’implémenter le même algorithme ? Voici comment je le ferais avec Cactoos, qui est simplement une collection de classes Java simples HTMLprimitiveHTML :</p><p>java new And( new Mapped&lt;Double, Scalar<Boolean>&gt;( new Limited<Double>( new Filtered<Double>( probes, probe -&gt; probe != 0.0d &amp;&amp; probe != 1.0d ), 10 ), probe -&gt; () -&gt; { System.out.printf( "Probe #%d: %f", 0, probe * 100.0d ); return true; } ) ).value();</Double></Double></Boolean></p><p>Let’s see what’s going on here. First, Filtered decorates our iterable probes to take certain items out of it. Notice that Filtered implements Iterable. Then Limited, also being an Iterable, takes only the first ten items out. Then Mapped converts each probe into an instance of Scalar<Boolean>, which does the line printing.</Boolean></p><p>Enfin, l’instance de And parcourt la liste des “scalaires” et demande à chacun d’entre eux de renvoyer un booléen. Ils impriment la ligne et renvoient true. Étant donné que c’est vrai, And tente avec le prochain scalaire. Enfin, sa méthode value() renvoie true.</p><p>Mais attendez, il n’y a pas d’index. Ajoutons-les. Pour ce faire, utilisons simplement une autre classe appelée AndWithIndex.</p><p>java nouveau AndWithIndex( nouveau Mapped&lt;Double, Func&lt;Integer, Boolean»( nouveau Limited<Double>( nouveau Filtered<Double>( sondes, sonde -&gt; sonde != 0.0d &amp;&amp; sonde != 1.0d ), 10 ), sonde -&gt; index -&gt; { System.out.printf( "Sonde #%d: %f", index, sonde * 100.0d ); return true; } ) ).value();</Double></Double></p><p>Instead of Scalar<Boolean>, nous cartographions maintenant nos sondes vers Func&lt;Integer, Boolean&gt; pour leur permettre d'accepter l'indice.</Boolean></p><p>La beauté de cette approche est que toutes les classes et interfaces sont petites et c’est pourquoi elles sont très composables. Pour créer un itérable de sondes limité, nous le décorons avec Limited; pour le filtrer, nous le décorons avec Filtered; pour faire autre chose, nous créons un nouveau décorateur et l’utilisons. Nous ne sommes pas limités à une seule interface comme Stream.</p><p>La conclusion est que les décorateurs sont un instrument orienté objet pour modifier le comportement des collections, tandis que les flux (streams) sont quelque chose d’autre pour lequel je ne peux même pas trouver le nom.</p><p>P.S. By the way, this is how the same algorithm can be implemented with the help of Guava’s Iterables.</p><p>java Iterable<Double> ready = Iterables.limit( Iterables.filter( probes, probe -&gt; probe != 0.0d &amp;&amp; probe != 1.0d ), 10 ); int pos = 0; for (Double probe : probes) { System.out.printf( "Probe #%d: %f", pos++, probe * 100.0d ); }</Double></p><p>C’est une étrange combinaison de styles orientés objet et fonctionnels.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/0.0.14</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?3a3b5d6c83f"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
