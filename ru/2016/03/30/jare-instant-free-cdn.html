<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="If you want your images, script, or CSS files be available via a CDN, use jare.io, an instant and free service." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Jare.io, an Instant and Free CDN"/> <meta name="twitter:description" property="og:description" content="If you want your images, script, or CSS files be available via a CDN, use jare.io, an instant and free service."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2016/03/30/jare-instant-free-cdn.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?fde5dc788ce"/> <link rel="apple-touch-icon" href="/favicon.ico?fde5dc788ce"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?fde5dc788ce"/> <link rel="stylesheet" href="/css/icons.css?fde5dc788ce"/> <link rel="canonical" href="https://www.yegor256.com/ru/2016/03/30/jare-instant-free-cdn.html" /> <title>Jare.io, an Instant and Free CDN</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;390</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Jare.io, an Instant and Free CDN</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2016/03/30/jare-instant-free-cdn.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>CDN означает сеть доставки контента. Технически, это набор серверов, расположенных в разных странах и на континентах. Вы передаете им свой <code class="language-plaintext highlighter-rouge">logo.gif</code>, а они дадут вам URL, который будет разрешаться на разные серверы в зависимости от того, кто его пытается разрешить. В результате файл всегда будет близким к конечному пользователю, и ваш веб-сайт загружается намного быстрее, чем без CDN. Звучит замечательно, но все провайдеры CDN хотят деньги за свои услуги и, как правило, требуют довольно сложного настройки и процедуры регистрации. Мой личный проект <a href="http://www.jare.io">jare.io</a> - это бесплатная CDN, которая легко настраивается. Он использует ресурсы AWS CloudFront.</p><p>Сначала позвольте мне показать, как это работает, а затем, если вам интересны подробности, я объясню, как это делается внутри. Предположим, у вас есть такой HTML:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;img src="//www.teamed.io/image/logo.svg"/&gt;
</code></pre></div></div><p>Я хочу, чтобы этот <code class="language-plaintext highlighter-rouge">logo.svg</code> был доставлен через CDN. Есть два шага. Сначала я регистрирую свой домен на <a href="http://www.jare.io">jare.io</a>:</p><p>Второе, я изменяю свой HTML:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;img src="//cf.jare.io/?u=http://www.teamed.io/images/logo.svg"/&gt;
</code></pre></div></div><p>That’s it.</p><p>Попробуйте сами использовать свои ресурсы, и вы увидите, насколько быстрее они будут загружаться.</p><p>Это абсолютно бесплатно, но прошу вас быть разумными. Если ваш трафик огромен, вам потребуется собственная учетная запись в CloudFront или в другом месте. Моя услуга предназначена для малых проектов.</p><p>Теперь перейдем к более техническим деталям, если вы хотите узнать, как технически работает данное решение. Сначала обсудим, что такое CDN и как оно работает.</p><h2 id="url-dns-tcp-http">URL, DNS, TCP, HTTP</h2><p>Когда ваш браузер хочет загрузить изображение, у него есть <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a> для этого, как в примере выше. Вот URL: <code class="language-plaintext highlighter-rouge">http://www.teamed.io/image/logo.svg</code>. В этом адресе есть три важные части. Первая - <code class="language-plaintext highlighter-rouge">http</code>, <a href="https://en.wikipedia.org/wiki/Communications_protocol">протокол</a>. Вторая - <code class="language-plaintext highlighter-rouge">www.teamed.io</code>, имя <a href="https://en.wikipedia.org/wiki/Host_%28network%29">хоста</a>, и конечная часть <code class="language-plaintext highlighter-rouge">/images/logo.svg</code>, которая является <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier#Syntax">путем</a>. Чтобы загрузить изображение, браузер должен открыть <a href="https://en.wikipedia.org/wiki/Network_socket">сокет</a>, соединяющий ваш компьютер и сервер, на котором находится изображение. Чтобы открыть сокет, браузеру нужно знать <a href="https://en.wikipedia.org/wiki/IP_address">IP-адрес</a> сервера.</p><p>В этом URL нет такого адреса. Чтобы найти IP-адрес, браузер выполняет то, что называется поиском. Он подключается к ближайшему <a href="https://en.wikipedia.org/wiki/Name_server">именному серверу</a> и спрашивает: “какой IP-адрес у www.teamed.io?”. Ответ обычно содержит один IP-адрес:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nslookup www.teamed.io
Server:   172.16.0.1
Address:  172.16.0.1#53

Non-authoritative answer: www.teamed.io canonical name = teamed.github.io. teamed.github.io canonical name = github.map.fastly.net. Name: github.map.fastly.net Address: 199.27.79.133 ```



IP-адрес `www.teamed.io` равен `199.27.79.133` на момент написания.

Когда адрес известен, браузер открывает новый сокет и отправляет [HTTP-запрос](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_message) через него:

</code></pre></div></div><p>GET /images/logo.svg HTTP/1.1 Host: www.teamed.io Accept: image/*</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Сервер отвечает [HTTP-ответом](https://ru.wikipedia.org/wiki/HTTP#HTTP-ответ),:

```text
HTTP/1.1 200 OK
Content-Type: image/svg+xml

[SVG image content goes here, over 1000 bytes] ```

Это и есть изображение [SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics), которое мы ищем. Браузер отображает его на веб-странице и все.

## The Network of Edge Servers

Пока все хорошо, но если расстояние между вашим браузером и этим IP-адресом довольно большое, загрузка изображения займет много времени. Ну, сотни миллисекунд. Попробуйте загрузить это изображение, которое находится на сервере, расположенном в Праге, Чешская Республика (я использую `curl`, как предложено [здесь] (https://josephscott.org/archives/2011/10/timing-details-with-curl/)).

</code></pre></div></div><p>$ curl -w “@f.txt” -o /dev/null -s <br /> http://www.vlada.cz/images/vlada/vlada-ceske-republiky_en.gif time_namelookup: 0.005 time_connect: 0.376 time_pretransfer: 0.377 time_starttransfer: 0.566 ———- time_total: 0.567</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>








Я пытаюсь сделать это из Пало-Альто, Калифорния, которая находится примерно на половине глобуса от Праги. Как видите, это занимает более 500 мс. Это слишком долго, особенно если на веб-странице содержится много изображений. В целом, загрузка страницы может занимать секунды только потому, что сервер слишком далеко от меня. Что ж, он неизбежно будет слишком далеко от некоторых пользователей, независимо от того, где мы его разместим. Если мы разместим его здесь, в Калифорнии, он будет достаточно близким ко мне, и изображение будет загружаться мгновенно (менее 50 мс). Но зато он будет слишком медленным для пользователей в Праге.

У этой проблемы нет решения, если сервер генерирует изображения или страницы на лету по-своему уникальному способу и если мы не можем установить несколько серверов в разных странах и континентах. Но в большинстве случаев, как в нашем примере с логотипом, это не проблема. Этот логотип не должен быть уникальным для каждого пользователя. Это очень *статический* ресурс, который нужно создать только один раз и передать всем без изменений.

Что, если мы установим сервер где-то здесь, в Калифорнии, и позволим пользователям из Калифорнии подключаться к нему? Когда запрос на `logo.gif` поступает на один из *крайних* серверов, он соединяется с центральным сервером в Праге и загружает файл. Это происходит только один раз. После этого крайний сервер не будет запрашивать файл у центрального сервера. Он будет сразу возвращать его из своего внутреннего кэша.

Нам нужно иметь много крайних серверов, желательно во всех странах, где могут находиться наши пользователи. Первый запрос займет больше времени, но все последующие будут намного быстрее, потому что они будут обслуживаться с ближайшего крайнего сервера.

Теперь вопрос в том, как браузер узнает, какой крайний сервер является ближайшим, верно? Мы просто обманываем процесс разрешения доменных имен. В зависимости от того, кто спрашивает, DNS дает разные ответы. Возьмем, например, `cf.jare.io` (это имя всех крайних серверов, ответственных за доставку нашего контента в AWS CloudFront, CNAME для `djk1be5eatcae.cloudfront.net`). Если я ищу его из Калифорнии, я получаю следующий ответ:

```text
$ nslookup cf.jare.io
Server:   192.168.1.1
Address:  192.168.1.1#53

Non-authoritative answer: cf.jare.io canonical name = djk1be5eatcae.cloudfront.net. Name: djk1be5eatcae.cloudfront.net Address: 54.230.141.211 ```

Крайний сервер с IP-адресом `54.230.141.211` расположен в [Сан-Франциско](https://db-ip.com/54.230.141.211). Это довольно близко ко мне, менее пятидесяти миль. Если я выполняю ту же операцию с сервера в Вирджинии, я получаю другой ответ.

```text
$ nslookup cf.jare.io
Server:   172.16.0.23
Address:  172.16.0.23#53

Non-authoritative answer: cf.jare.io canonical name = djk1be5eatcae.cloudfront.net. Name: djk1be5eatcae.cloudfront.net Address: 52.85.131.217 ```



Находящийся в [Вашингтоне](https://db-ip.com/52.85.131.217) периферийный сервер с IP-адресом `52.85.131.217` находится далеко от меня, но очень близко к серверу, с которого я выполнял запрос.

По всему миру существует тысячи серверов имен, и у каждого из них есть разная информация о физическом местонахождении этого периферийного сервера `cf.jare.io`. В зависимости от того, кто спрашивает, ответ будет разным.

## AWS CloudFront







[CloudFront](https://aws.amazon.com/cloudfront/) является одним из самых простых решений CDN. Все, что вам нужно сделать, чтобы начать доставку вашего контента через их краевые узлы, это создать "распределение" и настроить его. Распределение - это в основном соединитель между источником контента и краевыми серверами:

skinparam componentStyle uml2 Браузер -right-&gt; [Край] [Край] -right-&gt; [Центральный] [Центральный] -right-&gt; [Источник]

Один из краевых серверов получает HTTP-запрос. Если он уже имеет `logo.svg` в своем кэше, он немедленно возвращает HTTP-ответ с его содержимым. Если его кэш пуст, краевой сервер отправляет HTTP-запрос на центральный сервер. Этот сервер знает о "распределении" и его конфигурации. Он устанавливает HTTP-соединение с сервером-источником, который является `www.teamed.io`, и просит его вернуть `logo.svg`. После выполнения изображение возвращается на краевой сервер, где оно кэшируется.

Это выглядит довольно просто, но это не бесплатно и не так быстро настраивается. Вам нужно создать учетную запись в CloudFront, зарегистрировать там свою кредитную карту и получить одобрение. Затем вам нужно создать распределение и настроить его. Вы должны создать CNAME на вашем сервере имен. Если вы делаете это для одного веб-сайта, это не большая проблема. Если у вас есть десятки веб-сайтов, это занимает много времени.

## Jare.io, a Middle Man





Jare.io - это дополнительный компонент в этой диаграмме, который облегчает вашу жизнь:

skinparam componentStyle uml2 Браузер -right-&gt; [Edge] [Edge] -right-&gt; [Центральный] [Центральный] -down-&gt; [Реле] [Реле] -right-&gt; [Оригинал]

У Jare.io есть "реле", которое действует в качестве исходного сервера для CloudFront. Все запросы, поступающие на `cf.jare.io`, отправляются на реле. Реле решает, что с ними делать. Решение основано на информации из URI HTTP-запроса. Например, у запроса от браузера есть такой путь URI:

</code></pre></div></div><p>/?u=http://www.teamed.io/images/logo.svg</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>




Помните, что запрос делается на `cf.jare.io`, который является адресом сервера-края. Этот точный URI поступает на `relay.jare.io`. URI содержит достаточно информации для принятия решения о том, какой файл должен быть возвращен. Реле делает новый HTTP-запрос на `www.teamed.io` и получает изображение.

Красота этого решения в том, что оно простое. Для небольших веб-сайтов это бесплатная и быстрая CDN.

Кстати, когда мы запрашиваем то же изображение через jare.io (и CloudFront), оно возвращается намного быстрее.

</code></pre></div></div><p>$ curl -w “@f.txt” -o /dev/null -s <br /> http://cf.jare.io/?u=www.vlada.cz/images/vlada/vlada-ceske-republiky_en.gif time_namelookup: 0.005 time_connect: 0.021 time_pretransfer: 0.021 time_starttransfer: 0.041 ———- time_total: 0.041 ```</p><p>Большая часть работы выполняется с помощью AWS CloudFront, в то время как jare.io является всего лишь ретранслятором, который облегчает его настройку. Кроме того, он делает использование бесплатным, потому что jare.io спонсируется <a href="https://www.zerocracy.com">Zerocracy</a>. Другими словами, моя компания будет оплачивать ваше использование CloudFront. Я был бы благодарен, если бы вы имели это в виду и не использовали jare.io для ресурсов с интенсивным трафиком.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/36 on 2023-10-30 at 05:07</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?fde5dc788ce"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
