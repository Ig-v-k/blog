<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="If you want your images, script, or CSS files be available via a CDN, use jare.io, an instant and free service." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Jare.io, an Instant and Free CDN"/> <meta name="twitter:description" property="og:description" content="If you want your images, script, or CSS files be available via a CDN, use jare.io, an instant and free service."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2016/03/30/jare-instant-free-cdn.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?51fc39892f0"/> <link rel="apple-touch-icon" href="/favicon.ico?51fc39892f0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?51fc39892f0"/> <link rel="stylesheet" href="/css/icons.css?51fc39892f0"/> <link rel="canonical" href="https://www.yegor256.com/ru/2016/03/30/jare-instant-free-cdn.html" /> <title>Jare.io, an Instant and Free CDN</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Jare.io, an Instant and Free CDN</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2016/03/30/jare-instant-free-cdn.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>CDN означает сеть доставки контента. Технически, это набор серверов, расположенных в разных странах и континентах. Вы передаете им свой <code class="language-plaintext highlighter-rouge">logo.gif</code>, а они предоставляют вам URL, который разрешается на другой сервер в зависимости от того, кто пытается его разрешить. В результате файл всегда находится близко к конечному пользователю, и ваш веб-сайт загружается намного быстрее, чем без CDN. Звучит замечательно, но все провайдеры CDN хотят деньги за свои услуги и обычно требуют достаточно сложной настройки и процедуры регистрации. Мой личный проект <a href="http://www.jare.io">jare.io</a> - это бесплатная CDN, которую легко настроить. Она использует ресурсы AWS CloudFront.</p><p>Сначала позвольте мне показать, как это работает, а затем, если вам интересны подробности, я объясню, как это делается внутренне. Предположим, у вас есть этот HTML:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;img src="//www.teamed.io/image/logo.svg"/&gt;
</code></pre></div></div><p>Я хочу, чтобы этот <code class="language-plaintext highlighter-rouge">logo.svg</code> был доставлен через CDN. Есть два шага. Сначала я регистрирую свой домен на <a href="http://www.jare.io">jare.io</a>:</p><p>Во-вторых, я изменяю свой HTML:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;img src="//cf.jare.io/?u=http://www.teamed.io/images/logo.svg"/&gt;
</code></pre></div></div><p>That’s it.</p><p>Попробуйте это с вашими собственными ресурсами и вы увидите, как быстрее они будут загружаться.</p><p>Это абсолютно бесплатно, но прошу вас быть разумными. Если ваш трафик огромный, вам потребуется собственная учетная запись в CloudFront или в другом месте. Мой сервис предназначен для небольших проектов.</p><p>Теперь перейдем к более техническим деталям, если вы хотите узнать, как технически работает эта решение. Сначала давайте обсудим, что такое CDN и как оно работает.</p><h2 id="url-dns-tcp-http">URL, DNS, TCP, HTTP</h2><p>Когда ваш браузер хочет загрузить изображение, у него есть <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a> для этого, как в приведенном выше примере. Вот этот URL: <code class="language-plaintext highlighter-rouge">http://www.teamed.io/image/logo.svg</code>. В этом адресе есть три важные части. Первая - это <code class="language-plaintext highlighter-rouge">http</code>, <a href="https://en.wikipedia.org/wiki/Communications_protocol">протокол</a>. Вторая - <code class="language-plaintext highlighter-rouge">www.teamed.io</code>, имя <a href="https://en.wikipedia.org/wiki/Host_%28network%29">хоста</a>, а хвост <code class="language-plaintext highlighter-rouge">/images/logo.svg</code> - это <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier#Syntax">путь</a>. Чтобы загрузить изображение, браузер должен открыть <a href="https://en.wikipedia.org/wiki/Network_socket">сокет</a>, соединяющий ваш компьютер и сервер, на котором находится изображение. Чтобы открыть сокет, браузеру нужно знать <a href="https://en.wikipedia.org/wiki/IP_address">IP-адрес</a> сервера.</p><p>В этом URL-адресе отсутствует такой адрес. Чтобы найти IP-адрес, браузер выполняет так называемый поиск. Он подключается к ближайшему <a href="https://en.wikipedia.org/wiki/Name_server">именному серверу</a> и спрашивает: “какой IP-адрес у www.teamed.io?” Ответ обычно содержит один IP-адрес:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nslookup www.teamed.io
Server:   172.16.0.1
Address:  172.16.0.1#53

Non-authoritative answer: www.teamed.io canonical name = teamed.github.io. teamed.github.io canonical name = github.map.fastly.net. Name: github.map.fastly.net Address: 199.27.79.133 ```

IP-адрес `www.teamed.io` на момент написания составляет `199.27.79.133`.

Когда известен адрес, браузер открывает новый сокет и отправляет через него [HTTP-запрос](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_message).

</code></pre></div></div><p>GET /images/logo.svg HTTP/1.1 Host: www.teamed.io Accept: image/*</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Сервер отвечает [HTTP-ответом](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Response_message):

```text
HTTP/1.1 200 OK
Content-Type: image/svg+xml

[SVG image content goes here, over 1000 bytes] ```

Это изображение [SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics), которое мы ищем. Браузер отображает его на веб-странице, и все.

## The Network of Edge Servers

Пока все идет хорошо, но если расстояние между вашим браузером и этим IP-адресом довольно большое, загрузка изображения займет много времени. Что-то около сотен миллисекунд. Попробуйте загрузить это изображение, которое находится на сервере, размещенном в Праге, Чешской Республике (я использую `curl`, как рекомендовано [здесь](https://josephscott.org/archives/2011/10/timing-details-with-curl/)).

</code></pre></div></div><p>$ curl -w “@f.txt” -o /dev/null -s <br /> http://www.vlada.cz/images/vlada/vlada-ceske-republiky_en.gif time_namelookup: 0.005 time_connect: 0.376 time_pretransfer: 0.377 time_starttransfer: 0.566 ———- time_total: 0.567</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Я пытаюсь сделать это из Пало-Альто, Калифорния, что находится примерно наполовину земного шара от Праги. Как видите, это занимает более 500 мс. Это слишком много, особенно если веб-страница содержит много изображений. В целом, загрузка страницы может занимать несколько секунд, просто потому что сервер слишком далеко от меня. Ну, он неизбежно будет слишком далеко от некоторых пользователей, независимо от того, где мы его размещаем. Если мы разместим его здесь, в Калифорнии, он будет достаточно близко ко мне, и изображение будет загружаться мгновенно (менее 50 мс). Но затем оно будет слишком медленным для пользователей в Праге.

Эта проблема не имеет решения, если сервер генерирует изображения или страницы динамически по какому-то уникальному образу, и если мы не можем установить несколько серверов в разных странах и континентах. Но в большинстве случаев, как в примере с нашим логотипом, это не проблема. Этот логотип не требует быть уникальным для каждого пользователя. Это очень *статичный* ресурс, который должен быть создан только один раз и доставлен каждому без каких-либо изменений.

Итак, что насчет того, чтобы установить сервер где-нибудь здесь, в Калифорнии, и позволить калифорнийским пользователям подключаться к нему? Когда запрос на `logo.gif` поступает на один из *edge* серверов, он будет подключаться к центральному серверу в Праге и загружать файл. Это случится только один раз. После этого *edge* сервер не будет запрашивать файл у центрального сервера. Он будет сразу возвращать его из своего внутреннего кэша.

Нам нужно иметь много граничных серверов, желательно во всех странах, где могут находиться наши пользователи. Первый запрос займет больше времени, но все последующие будут выполняться намного быстрее, так как они будут обрабатываться ближайшим граничным сервером.

Теперь вопрос в том, как браузер узнает, какой крайний сервер находится ближе, верно? Мы просто обманываем процесс разрешения имени домена. В зависимости от того, кто спрашивает, DNS даст разные ответы. Давайте возьмем, например, `cf.jare.io` (это имя всех крайних серверов, ответственных за доставку нашего контента в AWS CloudFront, CNAME для `djk1be5eatcae.cloudfront.net`). Если я ищу его из Калифорнии, я получаю следующий ответ:

```text
$ nslookup cf.jare.io
Server:   192.168.1.1
Address:  192.168.1.1#53

Non-authoritative answer: cf.jare.io canonical name = djk1be5eatcae.cloudfront.net. Name: djk1be5eatcae.cloudfront.net Address: 54.230.141.211 ```

Находится краевой сервер с IP-адресом `54.230.141.211` в [Сан-Франциско](https://db-ip.com/54.230.141.211). Это довольно близко ко мне, менее пятидесяти миль. Если я выполню ту же операцию с сервера в Виргинии, я получу другой ответ:

```text
$ nslookup cf.jare.io
Server:   172.16.0.23
Address:  172.16.0.23#53

Non-authoritative answer: cf.jare.io canonical name = djk1be5eatcae.cloudfront.net. Name: djk1be5eatcae.cloudfront.net Address: 52.85.131.217 ```

Находящийся в [Вашингтоне](https://db-ip.com/52.85.131.217) периферийный сервер с IP-адресом `52.85.131.217` находится далеко от меня, но очень близко к серверу, с которого я выполнял запрос.

Во всем мире существует тысячи серверов имен, и у каждого из них есть разная информация о физическом местонахождении этого крайнего сервера `cf.jare.io`. В зависимости от того, кто спрашивает, ответ будет разным.

## AWS CloudFront

[CloudFront](https://aws.amazon.com/cloudfront/) - одно из самых простых решений CDN. Все, что вам нужно сделать, чтобы начать доставку вашего контента через их кэширующие сервера, это создать "дистрибуцию" и настроить ее. Дистрибуция в основном является связующим звеном между источником контента и кэширующими серверами.

skinparam componentStyle uml2 Браузер -right-&gt; [Edge] [Edge] -right-&gt; [Central] [Central] -right-&gt; [Origin]

Один из серверов с края получает HTTP-запрос. Если у него уже есть `logo.svg` в кэше, он немедленно возвращает HTTP-ответ с его содержимым. Если его кэш пуст, сервер с края делает HTTP-запрос к центральному серверу. Этот сервер знает о "распределении" и его конфигурации. Он устанавливает HTTP-соединение с сервером-источником, который является `www.teamed.io`, и просит его вернуть `logo.svg`. После завершения операции изображение возвращается на сервер с края, где оно кэшируется.

Это выглядит довольно просто, но это не бесплатно и настройка занимает некоторое время. Вам нужно создать учетную запись в CloudFront, зарегистрировать там свою кредитную карту и получить одобрение. Затем вам нужно создать распределение и настроить его. Вы также должны создать этот CNAME в вашем сервере имен. Если вы делаете это только для одного веб-сайта, это не такая большая проблема. Если у вас есть дюжина веб-сайтов, это займет много времени.

## Jare.io, a Middle Man

Jare.io - это дополнительный компонент на этой диаграмме, который облегчает вашу жизнь.

skinparam componentStyle uml2 Браузер -right-&gt; [Edge] [Edge] -right-&gt; [Central] [Central] -down-&gt; [Relay] [Relay] -right-&gt; [Origin]

Jare.io имеет "реле", которое действует в качестве исходного сервера для CloudFront. Все запросы, поступающие на `cf.jare.io`, направляются на реле. Реле принимает решение о том, что делать с ними. Решение принимается на основе информации из URI-пути HTTP-запроса. Например, у запроса из браузера есть такой URI-путь:

</code></pre></div></div><p>/?u=http://www.teamed.io/images/logo.svg</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Помните, что запрос отправляется на `cf.jare.io`, который является адресом кэш-сервера. Этот точный URI приходит на `relay.jare.io`. URI содержит достаточно информации для принятия решения о том, какой файл должен быть возвращен. Реле создает новый HTTP-запрос на `www.teamed.io` и получает изображение.

Красота этого решения заключается в его простоте. Для небольших веб-сайтов это бесплатный и быстрый CDN.

Кстати, когда мы запрашиваем то же самое изображение через jare.io (и CloudFront), оно возвращается гораздо быстрее.

</code></pre></div></div><p>$ curl -w “@f.txt” -o /dev/null -s <br /> http://cf.jare.io/?u=www.vlada.cz/images/vlada/vlada-ceske-republiky_en.gif time_namelookup: 0.005 time_connect: 0.021 time_pretransfer: 0.021 time_starttransfer: 0.041 ———- time_total: 0.041 ```</p><p>Большая часть работы выполняется AWS CloudFront, в то время как jare.io является всего лишь промежуточным звеном, делающим его конфигурацию более удобной. Кроме того, это делает его бесплатным, потому что jare.io спонсируется <a href="https://www.zerocracy.com">Zerocracy</a>. Другими словами, моя компания будет оплачивать использование CloudFront. Я был бы признателен, если бы вы имели это в виду и не использовали jare.io для ресурсов с высокой нагрузкой на трафик.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/002 on 2023-08-28 at 19:26</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?51fc39892f0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
