<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Continuous integration doesn't work while programmers are able to commit into the master branch. This article explains why and proposes a solution." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Master Branch Must Be Read-Only"/> <meta name="twitter:description" property="og:description" content="Continuous integration doesn't work while programmers are able to commit into the master branch. This article explains why and proposes a solution."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2014/07/21/read-only-master-branch.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?d1b9aa7d6e2"/> <link rel="apple-touch-icon" href="/favicon.ico?d1b9aa7d6e2"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?d1b9aa7d6e2"/> <link rel="stylesheet" href="/css/icons.css?d1b9aa7d6e2"/> <link rel="canonical" href="https://www.yegor256.com/ru/2014/07/21/read-only-master-branch.html" /> <title>Master Branch Must Be Read-Only</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;387</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Master Branch Must Be Read-Only</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2014/07/21/read-only-master-branch.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>Непрерывная интеграция - это просто. Скачайте Jenkins, установите, создайте задачу, нажмите кнопку и получите приятное письмо, которое говорит о том, что ваша сборка повреждена (я предполагаю, что ваша сборка автоматизирована). Затем исправьте поврежденные тесты (я предполагаю, что у вас есть тесты) и получите гораздо более привлекательное письмо, которое говорит о том, что ваша сборка чиста.</p><p>Затем напишите твит об этом, заявляя, что ваша команда использует непрерывную интеграцию.</p><p>Затем, через несколько недель, начните фильтровать уведомления от Jenkins в отдельную папку, чтобы они больше не мешали вам. В любом случае, вашей команде нет времени или желания исправлять все модульные тесты каждый раз, когда кто-то их нарушает.</p><p>В конце концов, все мы знаем, что юнит-тестирование не предназначено для команды, работающей под давлением сроков, верно?</p><p>Неверно. Непрерывная интеграция может и должна работать.</p><h2 id="what-is-continuous-integration">What is Continuous Integration?</h2><p>В настоящее время программное обеспечение разрабатывается командами. Мы разрабатываем в отдельных ветках и изолируем изменения во время разработки. Затем мы объединяем ветки в <code class="language-plaintext highlighter-rouge">master</code>. После каждого объединения мы тестируем весь продукт, выполняя все доступные модульные и интеграционные тесты. Это называется <a href="https://en.wikipedia.org/wiki/Continuous_integration">непрерывной интеграцией</a> (или “CI”).</p><p>Иногда некоторые тесты не проходят успешно. Когда это происходит, мы говорим, что наша “сборка сломана”. Такая неудача является положительным побочным эффектом контроля качества, потому что она сразу поднимает красный флаг после того, как ошибка попадает в <code class="language-plaintext highlighter-rouge">master</code>.</p><p>Это хорошо известная практика, когда устранение этой ошибки становится приоритетом для ее автора и всей команды. Ошибка должна быть исправлена сразу после появления красного флага сервером непрерывной интеграции.</p><p><a href="http://amzn.to/2bQVmlb">Непрерывная доставка (Continuous Delivery) - Джеф Хамбл и др.</a> идеально объясняет этот подход в главе 7, страницы 169–186.</p><p>На рынке есть несколько хороших инструментов, которые автоматизируют процессы DevOps. Некоторые из них являются открытыми и вы можете их скачать и установить на свои собственные серверы. Например: <a href="https://jenkins-ci.org/">Jenkins</a>, <a href="https://www.thoughtworks.com/products/go-continuous-delivery">Go</a> и <a href="https://cruisecontrol.sourceforge.net/">CruiseControl</a>. Некоторые из них доступны как облачные сервисы, такие как: <a href="https://www.travis-ci.org">Travis</a>, <a href="https://www.shippable.com">Shippable</a>, Wercker и многие другие.</p><h2 id="why-continuous-integration-doesnt-work">Why Continuous Integration Doesn’t Work?</h2><p>CI хороша, но чем больше команда (и кодовая база), тем чаще сборки ломаются. И чем дольше их восстанавливают. Я видел много случаев, когда трудолюбивая команда начинает игнорировать красные флаги, поднятые Jenkins’ом, после нескольких недель попыток не отставать.</p><p>Команда просто становится неспособной исправить все ошибки вовремя. Главным образом, потому что у бизнеса есть другие приоритеты. Владельцы продукта не понимают важности “чистой сборки”, а технические руководители не могут выделить время на исправление модульных тестов. Более того, код, который их сломал, уже находится в <code class="language-plaintext highlighter-rouge">master</code>, и в большинстве случаев уже был развернут в продакшн и доставлен конечным пользователям. Какая срочность в исправлении некоторых тестов, если бизнес-ценность уже доставлена?</p><p>В конце концов, большинство команд разработчиков не воспринимают предупреждения о непрерывной интеграции всерьез. Для них Jenkins или Travis - это просто модные инструменты, которые не играют роли во всем процессе разработки и доставки. Независимо от того, что говорит сервер непрерывной интеграции, мы все равно доставляем новые функции нашим конечным пользователям. Мы исправим нашу сборку позже. И это только логично.</p><h2 id="what-is-a-solution">What Is a Solution?</h2><p><a href="/pdf/2014/guard-article.pdf" class="em2" title="Prevent Conflicts in Distributed Agile PHP Projects"><i class="icon icon-pdf"></i></a></p><table> <tbody> <tr><td>Четыре года назад, в 2010 году, я опубликовал статью в [php</td><td>Architect](http://www.phparch.com/magazine/2010-2/august/) под названием “Предотвращение конфликтов в распределенных гибких проектах на PHP.” В статье было предложено решение (полная статья в <a href="/pdf/2014/guard-article.pdf">PDF</a>) для Subversion и PHP.</td></tr> </tbody> </table><p>С тех пор я экспериментально применял этот подход в нескольких проектах с открытым исходным кодом и нескольких коммерческих с использованием PHP, Java, Ruby и JavaScript, Git и Subversion. Во всех случаях мой опыт был только положительным, и именно поэтому был создан <a href="https://www.rultor.com">rultor.com</a> (о нем позже).</p><p>Итак, решение простое – запретить кому-либо сливать что-либо в <code class="language-plaintext highlighter-rouge">master</code> и создать скрипт, который может быть вызван любым. Скрипт будет сливать, тестировать и фиксировать изменения. Скрипт не будет делать исключений. Если хотя бы один модульный тест не проходит на любой ветке, вся ветка будет отклонена.</p><p>Другими словами, нам следует поднять красный флаг <strong>до</strong> того, как код попадет в <code class="language-plaintext highlighter-rouge">master</code>. Мы должны возложить вину за неисправные тесты на автора.</p><p>Скажем, я разрабатываю функцию в своей собственной ветке. Я завершил разработку и случайно сломал несколько тестов. Это случается, мы все ошибаемся. Я не могу объединить свои изменения с <code class="language-plaintext highlighter-rouge">master</code>. Git просто отклоняет мою <code class="language-plaintext highlighter-rouge">push</code>, потому что у меня нет соответствующих прав. Все, что я могу сделать, это вызвать магический скрипт, попросив его объединить мою ветку. Скрипт попытается объединить, но перед тем, как запушить в <code class="language-plaintext highlighter-rouge">master</code>, он запустит все тесты. И если какой-либо из них сломается, моя ветка будет отклонена. Мои изменения не будут объединены. Теперь это моя ответственность - исправить их и вызвать скрипт снова.</p><p>В начале такой подход замедляет разработку, потому что каждому приходится начинать писать более чистый код. В конце концов, однако, эта методика оправдывает себя на все сто.</p><h2 id="pre-flight-builds">Pre-flight Builds</h2><p>Некоторые CI-серверы предлагают функцию предварительной сборки, которая означает тестирование веток перед их объединением в <code class="language-plaintext highlighter-rouge">master</code>. Например, у Travis есть эта функция, и она очень полезна. Когда вы делаете новый коммит в ветке, Travis сразу же пытается собрать его и сообщает о проблемах в запросе на объединение в GitHub.</p><p>Обратите внимание, предварительные сборки перед полетом не объединяются. Они только проверяют, чиста ли ваша отдельная ветка. После объединения она может легко сломать <code class="language-plaintext highlighter-rouge">master</code>. И, конечно же, этот механизм не гарантирует, что никакие сотрудники не смогут прямо вносить изменения в <code class="language-plaintext highlighter-rouge">master</code>, непреднамеренно его сломав. Предварительные сборки перед полетом являются предупредительной мерой, но не решают проблему полностью.</p><h2 id="rultorcom">Rultor.com</h2><p>Для начала работы, как объяснялось выше, все, что вам нужно сделать, это отозвать права на запись для ветки <code class="language-plaintext highlighter-rouge">master</code> (или <code class="language-plaintext highlighter-rouge">/trunk</code> в Subversion).</p><p>К сожалению, это <a href="http://stackoverflow.com/questions/10381672">невозможно</a> на GitHub. Единственное решение - работать только через форки и запросы на объединение изменений. Просто удалите всех из списка “соавторов”, и они будут вынуждены отправлять изменения через запросы на объединение.</p><p>Затем начните использовать <a href="https://www.rultor.com">Rultor.com</a>, который поможет вам тестировать, объединять и отправлять каждый запрос на получение изменений (pull request). В основном, Rultor представляет собой скрипт, о котором мы говорили выше. Он доступен как бесплатный облачный сервис.</p><p>пс. Краткая версия этой статьи также опубликована на <a href="http://devops.com/blogs/continuous-integration-doesnt-work/">devops.com</a></p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Are you allowed to PUSH to the master/develop/trunk of your Version Control System (VCS)? <a href="https://twitter.com/hashtag/devops?src=hash&amp;ref_src=twsrc%5Etfw">#devops</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1142730754167889920?ref_src=twsrc%5Etfw">June 23, 2019</a></blockquote> <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/35 on 2023-09-09 at 06:01</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?d1b9aa7d6e2"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
