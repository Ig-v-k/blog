<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="On the Layout of Tests"/> <meta name="twitter:description" property="og:description" content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2023/01/19/layout-of-tests.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?91e21ef9338"/> <link rel="apple-touch-icon" href="/favicon.ico?91e21ef9338"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?91e21ef9338"/> <link rel="stylesheet" href="/css/icons.css?91e21ef9338"/> <link rel="canonical" href="https://www.yegor256.com/ru/2023/01/19/layout-of-tests.html" /> <title>On the Layout of Tests</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;386</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">On the Layout of Tests</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2023/01/19/layout-of-tests.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>Я не знаю, на каком языке программирования вы работаете, но мой опыт недавней разработки на Java, Ruby, JavaScript, PHP, Python, C++ и Rust говорит мне, что принцип, о котором я попытаюсь вас убедить придерживаться, универсален для всех языков. Речь идет о названии файлов с тестами. Возможно, вам это может показаться вопросом низкой важности, но позвольте мне попытаться показать, что это не так. Как вы называете файлы с классами тестов? Сколько из них вы создаете в каталоге src/test/java? Куда помещать класс, который используется только в тесте, но сам по себе не является тестом? На большинство этих вопросов большинство из вас скорее всего ответит “Как угодно!”. Итак, давайте попытаемся найти лучший ответ.</p><p>Основная цель моих модульных тестов - помочь мне в разработке. Они являются сетью безопасности, которая ловит меня, когда я совершаю ошибку. Например, предположим, что я возвращаюсь и редактирую несколько файлов, которые редактировал несколько лет назад, и, конечно же, на этот раз делаю это неправильно. Затем я запускаю все 500 модульных тестов в проекте и … десять из них становятся красными. Обратите внимание, я не говорю “ошибка”, потому что, как сеть безопасности вокруг здания, неудачные тесты - это те тесты, которые не поймали падающий молоток и не обнаружили только что возникшую ошибку. Таким образом, 490 из них <em>сбой</em>, но десять из них <em>успешны</em>.</p><h2 id="assertions">Assertions</h2><p>Затем я почесал затылок и задумался: что именно я сделал неправильно? Какой файл я сломал? Я просто изменил несколько десятков строк кода. Где именно была ошибка? Чтобы это выяснить, я прочитал вывод тестов. Я ожидаю, что сообщения, которые они выводят в консоль, будут достаточно описательными, чтобы помочь мне понять проблему. Я не хочу отменять все свои изменения и начинать с чистого листа, верно? Я хочу быстро перейти к строке с ошибкой, исправить ее, перезапустить все 500 тестов, увидеть, что все они прошли успешно, зафиксировать свои изменения и закончить на сегодня.</p><p>Не нужно говорить, что описательные сообщения о проверках и правильное именование методов тестирования - это рецепт успеха. Рассмотрим простой объект Phrases, где мы добавляем несколько английских фраз, и он магически понимает, какие из них являются приветствиями (очевидно, с помощью ML). Для такого класса этот тест на Java/JUnit5 был бы очень плохим.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>

<span class="nd">@Test</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">()</span> <span class="o">{</span> <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span> <span class="k">assert</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span> <span class="o">}</span> <span class="err">```</span>

<span class="nc">Хотя</span> <span class="n">этот</span> <span class="n">тест</span> <span class="n">намного</span> <span class="n">лучше</span> <span class="n">благодаря</span> <span class="n">утверждениям</span> <span class="o">[</span><span class="nc">Hamcrest</span><span class="o">](</span><span class="nl">https:</span><span class="c1">//www.hamcrest.org) (как называть методы тестирования - это отдельная история, подробно объясненная [здесь](https://stackoverflow.com/questions/155436/)):</span>

<span class="err">```</span><span class="n">java</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">equalTo</span><span class="o">;</span>

<span class="nd">@Test</span> <span class="kt">void</span> <span class="nf">countsSimpleGreetings</span><span class="o">()</span> <span class="o">{</span> <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span> <span class="n">assertThat</span><span class="o">(</span> <span class="s">"Total count of greetings"</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">);</span> <span class="o">}</span> <span class="err">```</span>

<span class="nc">Первый</span> <span class="n">отрывок</span> <span class="n">выведет</span> <span class="n">довольно</span> <span class="n">непонятное</span> <span class="n">сообщение</span> <span class="n">об</span> <span class="n">ошибке</span><span class="o">,</span> <span class="n">в</span> <span class="n">то</span> <span class="n">время</span> <span class="n">как</span> <span class="n">второй</span> <span class="n">поможет</span> <span class="n">мне</span> <span class="n">много</span> <span class="n">в</span> <span class="n">борьбе</span> <span class="n">с</span> <span class="n">только</span> <span class="n">что</span> <span class="n">созданной</span> <span class="nl">ошибкой:</span> <span class="nc">Сообщение</span> <span class="n">будет</span> <span class="n">самообъясняющимся</span><span class="o">.</span> <span class="no">Я</span> <span class="n">быстро</span> <span class="n">пойму</span><span class="o">,</span> <span class="n">в</span> <span class="n">чем</span> <span class="n">проблема</span><span class="o">.</span>

<span class="err">##</span> <span class="nc">Test</span> <span class="nc">Classes</span>

<span class="nc">Описательные</span> <span class="n">сообщения</span> <span class="n">помогут</span> <span class="n">мне</span> <span class="n">понять</span><span class="o">,</span> <span class="n">в</span> <span class="n">чем</span> <span class="n">проблема</span><span class="o">.</span> <span class="nc">Однако</span> <span class="n">я</span> <span class="n">узнаю</span> <span class="o">*</span><span class="n">где</span><span class="o">*</span> <span class="n">находится</span> <span class="n">проблема</span><span class="o">?</span> <span class="no">В</span> <span class="n">каком</span> <span class="n">классе</span> <span class="nc">Java</span><span class="o">?</span> <span class="nc">Не</span> <span class="n">совсем</span><span class="o">.</span> <span class="nc">Это</span> <span class="n">может</span> <span class="n">быть</span> <span class="n">в</span> <span class="err">`</span><span class="nc">Phrases</span><span class="o">.</span><span class="na">java</span><span class="err">`</span> <span class="n">или</span><span class="o">,</span> <span class="n">может</span> <span class="n">быть</span><span class="o">,</span> <span class="n">в</span> <span class="err">`</span><span class="nc">Greetings</span><span class="o">.</span><span class="na">java</span><span class="err">`</span><span class="o">,</span> <span class="n">которое</span> <span class="n">возвращает</span> <span class="err">`</span><span class="nc">Phrases</span><span class="o">.</span><span class="na">greetings</span><span class="o">()</span><span class="err">`</span><span class="o">?</span> <span class="no">Я</span> <span class="n">могу</span> <span class="n">получить</span> <span class="n">эту</span> <span class="n">информацию</span> <span class="n">только</span> <span class="n">из</span> <span class="o">*</span><span class="n">имени</span><span class="o">*</span> <span class="n">тестового</span> <span class="n">класса</span><span class="o">.</span> <span class="nc">Если</span> <span class="n">он</span> <span class="n">называется</span> <span class="err">`</span><span class="nc">PhrasesTest</span><span class="o">.</span><span class="na">java</span><span class="err">`</span><span class="o">,</span> <span class="n">то</span> <span class="n">все</span> <span class="n">ошибки</span><span class="o">,</span> <span class="n">которые</span> <span class="n">он</span> <span class="n">обнаруживает</span><span class="o">,</span> <span class="o">*</span><span class="n">скорее</span> <span class="n">всего</span><span class="o">*</span> <span class="n">находятся</span> <span class="n">в</span> <span class="err">`</span><span class="nc">Phrases</span><span class="o">.</span><span class="na">java</span><span class="err">`</span><span class="o">.</span> <span class="nc">Если</span> <span class="n">он</span> <span class="n">называется</span> <span class="err">`</span><span class="nc">GreetingsTest</span><span class="o">.</span><span class="na">java</span><span class="err">`</span> <span class="o">-</span> <span class="o">...</span> <span class="n">ну</span><span class="o">,</span> <span class="n">вы</span> <span class="n">понимаете</span> <span class="n">идею</span><span class="o">.</span>

<span class="nc">Моя</span> <span class="n">точка</span> <span class="n">зрения</span> <span class="n">заключается</span> <span class="n">в</span> <span class="n">том</span><span class="o">,</span> <span class="n">что</span> <span class="n">название</span> <span class="n">тестового</span> <span class="n">класса</span> <span class="o">-</span> <span class="n">это</span> <span class="n">не</span> <span class="n">просто</span> <span class="n">название</span><span class="o">.</span> <span class="nc">Это</span> <span class="n">инструкция</span> <span class="n">для</span> <span class="n">любознательного</span> <span class="nl">программиста:</span> <span class="s">"Посмотри в файл исходного кода, название которого можно получить, удалив суффикс `Test` из моего названия"</span><span class="o">.</span> <span class="nc">Если</span> <span class="n">я</span> <span class="n">пытаюсь</span> <span class="n">следовать</span> <span class="n">этой</span> <span class="n">инструкции</span> <span class="n">и</span> <span class="n">она</span> <span class="n">не</span> <span class="n">приводит</span> <span class="n">меня</span> <span class="n">никуда</span><span class="o">,</span> <span class="n">я</span> <span class="n">очень</span> <span class="n">разочаровываюсь</span><span class="o">,</span> <span class="n">особенно</span> <span class="n">если</span> <span class="n">проект</span> <span class="n">не</span> <span class="n">мой</span><span class="o">.</span> <span class="no">Я</span> <span class="n">не</span> <span class="n">могу</span> <span class="n">получить</span> <span class="n">нужную</span> <span class="n">информацию</span> <span class="n">ни</span> <span class="n">откуда</span><span class="o">-</span><span class="n">либо</span> <span class="n">еще</span><span class="o">.</span> <span class="nc">Название</span> <span class="n">тестового</span> <span class="n">класса</span> <span class="o">-</span> <span class="n">моя</span> <span class="n">последняя</span> <span class="n">надежда</span><span class="o">.</span>

<span class="err">##</span> <span class="nc">Very</span> <span class="nc">Long</span> <span class="nc">Test</span> <span class="nc">Classes</span>

<span class="nc">Что</span> <span class="n">делать</span><span class="o">,</span> <span class="n">если</span> <span class="n">класс</span> <span class="n">теста</span> <span class="n">становится</span> <span class="n">слишком</span> <span class="n">длинным</span><span class="o">?</span> <span class="no">В</span> <span class="n">нем</span> <span class="n">может</span> <span class="n">быть</span> <span class="n">несколько</span> <span class="n">десятков</span> <span class="n">или</span> <span class="n">даже</span> <span class="n">более</span> <span class="n">методов</span> <span class="n">тестирования</span><span class="o">.</span> <span class="nc">Мы</span> <span class="n">не</span> <span class="n">хотим</span><span class="o">,</span> <span class="n">чтобы</span> <span class="n">класс</span> <span class="n">был</span> <span class="n">слишком</span> <span class="n">большим</span><span class="o">,</span> <span class="n">верно</span><span class="o">?</span> <span class="nc">Неверно</span><span class="o">!</span> <span class="nc">Класс</span> <span class="n">теста</span> <span class="o">-</span> <span class="n">это</span> <span class="n">не</span> <span class="n">настоящий</span> <span class="n">класс</span><span class="o">.</span> <span class="nc">Это</span> <span class="n">даже</span> <span class="n">не</span> <span class="n">утилитарный</span> <span class="n">класс</span><span class="o">.</span> <span class="nc">Это</span> <span class="n">контейнер</span> <span class="n">для</span> <span class="n">тестовых</span> <span class="n">скриптов</span><span class="o">.</span> <span class="nc">Он</span> <span class="n">называется</span> <span class="n">классом</span> <span class="n">только</span> <span class="n">потому</span><span class="o">,</span> <span class="n">что</span> <span class="nc">Java</span> <span class="o">(</span><span class="n">и</span> <span class="n">многие</span> <span class="n">другие</span> <span class="n">языки</span><span class="o">)</span> <span class="n">не</span> <span class="n">предоставляют</span> <span class="n">альтернативных</span> <span class="n">инструментов</span> <span class="n">для</span> <span class="n">организации</span> <span class="n">кода</span><span class="o">.</span> <span class="nc">Поэтому</span> <span class="n">не</span> <span class="n">беспокойтесь</span> <span class="n">о</span> <span class="n">том</span><span class="o">,</span> <span class="n">что</span> <span class="n">ваши</span> <span class="n">классы</span> <span class="n">тестов</span> <span class="n">становятся</span> <span class="n">слишком</span> <span class="n">длинными</span><span class="o">.</span> <span class="mi">5000</span> <span class="n">строк</span> <span class="n">кода</span> <span class="n">в</span> <span class="n">классе</span> <span class="n">теста</span> <span class="o">-</span> <span class="o">*</span><span class="n">совершенно</span> <span class="n">не</span> <span class="n">проблема</span><span class="o">*.</span> <span class="nc">Опять</span> <span class="n">же</span><span class="o">,</span> <span class="n">потому</span> <span class="n">что</span> <span class="n">это</span> <span class="n">не</span> <span class="n">класс</span><span class="o">,</span> <span class="n">а</span> <span class="n">всего</span> <span class="n">лишь</span> <span class="n">сборник</span> <span class="n">тестовых</span> <span class="n">скриптов</span><span class="o">.</span>

<span class="err">##</span> <span class="nc">Test</span> <span class="nf">Prerequisites</span> <span class="o">(</span><span class="nc">Wrong</span> <span class="nc">Way</span><span class="o">)</span>

<span class="nc">Очень</span> <span class="n">часто</span> <span class="n">некоторые</span> <span class="n">классы</span> <span class="n">или</span> <span class="n">функции</span> <span class="n">не</span> <span class="n">являются</span> <span class="n">тестами</span><span class="o">,</span> <span class="n">но</span> <span class="n">должны</span> <span class="n">использоваться</span> <span class="n">в</span> <span class="n">нескольких</span> <span class="n">тестах</span><span class="o">.</span> <span class="o">(</span><span class="no">Я</span> <span class="n">уверен</span><span class="o">,</span> <span class="n">что</span> <span class="n">вы</span> <span class="n">знаете</span><span class="o">,</span> <span class="n">что</span> <span class="n">общие</span> <span class="n">тесты</span> <span class="o">-</span> <span class="n">это</span> <span class="n">антипаттерн</span><span class="o">.</span> <span class="nc">Вы</span> <span class="n">знаете</span> <span class="n">об</span> <span class="n">этом</span><span class="o">?)</span> <span class="nc">Посмотрите</span><span class="o">,</span> <span class="n">как</span> <span class="n">я</span> <span class="n">переработал</span> <span class="n">модульный</span> <span class="n">тест</span> <span class="n">выше</span> <span class="o">(</span><span class="n">это</span> <span class="n">совсем</span> <span class="n">неэлегантно</span><span class="o">,</span> <span class="n">но</span> <span class="n">пожалуйста</span><span class="o">,</span> <span class="n">потерпите</span> <span class="n">немного</span><span class="o">!).</span>

</code></pre></div></div><p>class PhrasesTest { @Test void countsSimpleGreetings() { Phrases p = new Phrases(); prepare(p); assertThat( “Total count of greetings”, p.greetings().count(), equalTo(1) ); } private static void prepare(Phrases p) { p.add(“Hello, world!”); p.add(“London is a capital of Great Britain”); } }</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Здесь, в закрытом методе `prepare(),` у меня есть удобный конструктор объекта класса `Phrases.` Этот конструктор может быть полезен для других тестов, таких как `GreetingsTest.` Я не хочу копировать его из `PhrasesTest` в `GreetingsTest.` Вместо этого я хочу поместить его где-то, где он может быть повторно использован. Это будет правильное место для этого (`foo` - это пакет Java, к которому принадлежат все наши классы).

</code></pre></div></div><p>src/ main/ java/ foo/ Phrases.java Greetings.java test/ java/ foo/ support/ FooUtils.java PhrasesTest.java GreetingsTest.java</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Статический метод `FooUtils.prepare()` теперь находится в утилитарном классе `FooUtils` (ужасный анти-паттерн!), который находится в пакете `foo.support`. Но обратите внимание, не в пакете `foo`, а в подпакете, который не имеет аналога в блоке живого кода: здесь нет директории `src/main/java/foo/support.` Это ясное сообщение программисту, который встретит этот репозиторий через несколько лет: все классы, находящиеся в `foo.support`, принадлежат только тестовому процессу и сами по себе не являются тестами.

## Test Prerequisites (Right Way)

Как вы знаете, утилитарные классы и приватные статические методы являются остатками императивного программирования. В объектно-ориентированном мире есть более лучшие альтернативы. В частности, JUnit5 предлагает достаточно элегантные механизмы для создания предварительных условий для тестов: [расширения тестирования](https://junit.org/junit5/docs/current/user-guide/#extensions-registration). Все, что нужно для метода тестирования, мы предоставляем через его параметры, которые создаются расширениями, например:

```java
import org.junit.jupiter.api.extension.*;

class PhrasesExtension implements ParameterResolver { @Override public boolean supportsParameter( ParameterContext pctx, ExtensionContext ectx) { return pctx.getParameter().getType() == Phrases.class; } @Override public Object resolveParameter( ParameterContext pctx, ExtensionContext ectx) { Phrases p = new Phrases(); p.add("Hello, world!"); p.add("London is a capital of Great Britain"); return p; } } ```

Затем тест будет выглядеть следующим образом:

```java
import org.junit.jupiter.api.extension.ExtendWith;

@ExtendWith(PhrasesExtension.class) class PhrasesTest { @Test void countsSimpleGreetings(Phrases p) { assertThat( "Total count of greetings", p.greetings().count(), equalTo(1) ); } } ```

Теперь тест и его предпосылки находятся в двух разных местах и не связаны так тесно, как раньше. Более того, предпосылки могут быть легко повторно использованы. Волшебная аннотация `@ExtendWith` может быть применена к другим тестам. Реализация `PhrasesExtension` может стать умнее: она может начать обращать внимание не только на тип аргумента метода теста, но и на пользовательскую аннотацию, примененную к нему (так работает [`@TempDir`](https://junit.org/junit5/docs/5.4.1/api/org/junit/jupiter/api/io/TempDir.html)).

## Fake Objects (Best Way)

Несмотря на красоту расширений JUnit, я не думаю, что они являются лучшим способом отделения предварительных требований от методов тестирования. Расширения JUnit все еще довольно сильно связаны... не с методами тестирования, а со всем набором тестов проекта. Если вы решите использовать их в другом месте, в другом проекте, вы не сможете это сделать.

Кроме того, если вы решите протестировать свои предварительные условия, вы не сможете сделать это изящно. Конечно, вы могли бы написать для них тесты в том же каталоге, но в этом случае вы нарушите принцип: один тест на один живой класс.

Решение заключается в использовании фиктивных объектов. Они находятся вместе с другими активными объектами, но обладают особым «фиктивным» поведением, например (кстати, мне не нравятся фабрики, но в данном случае это приемлемо):

</code></pre></div></div><p>class FactoryOfPhrases { public Phrases aboutLondon() { Phrases p = new Phrases(); p.add(“Hello, world!”); p.add(“London is a capital of Great Britain”); return p; } }</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Затем тест будет выглядеть так:

</code></pre></div></div><p>class PhrasesTest { @Test void countsSimpleGreetings() { assertThat( “Total count of greetings”, new FactoryOfPhrases().aboutLondon() .greetings().count(), equalTo(1) ); } }</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Расположение репозитория будет выглядеть так:

</code></pre></div></div><p>src/ main/ java/ foo/ FactoryOfPhrases.java Phrases.java Greetings.java test/ java/ foo/ FactoryOfPhrasesTest.java PhrasesTest.java GreetingsTest.java</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Обратите внимание на тест `FactoryOfPhrasesTest.` Он тестирует «фальшивый» объект `FactoryOfPhrases,` который является частью коллекции живых классов. Фабрика фраз поставляется вместе со всеми остальными классами. Поэтому ее можно использовать другими проектами не только для тестовых целей.

В заключение, как правило, я предлагаю держать тестовые классы чистыми: там должны быть только тестовые методы. Без атрибутов и, конечно же, без статических приватных методов. Все, что является предпосылкой, должно быть "фейковым" объектом.

## Integration Tests

В мире Maven существуют классы модульного тестирования (с суффиксом `Test`) и классы интеграционного тестирования (с суффиксом `ITCase`). Разница между ними огромна. Оба компилируются в фазе `test-compile` с использованием плагина `maven-compiler-plugin`, но они не выполняются вместе. Вместо этого, модульные тесты выполняются в фазе `test`. Сборка сразу завершается с ошибкой, если какой-либо модульный тест не проходит. Это довольно простой подход, который аналогичен другим средствам автоматизации сборки.

Интеграционные тесты выполняются в четыре этапа (это названия фаз Maven):

</code></pre></div></div><p>pre-integration-test integration-test post-integration-test verify</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Сначала ресурсы, необходимые для интеграционного тестирования, получаются на этапе `pre-integration-test`. Например, может быть запущен тестовый экземпляр базы данных MySQL. Затем тесты с использованием `ITCase` выполняются на этапе «integration-test». Результат их выполнения пока игнорируется, но записывается в файл. Затем ресурсы освобождаются на этапе `post-integration-test`. Например, сервер MySQL выключается. Наконец, на этапе `verify` результаты тестов проверяются, и сборка не проходит, если некоторые из них не проходят успешно.

Я храню файлы `ITCase` вместе с файлами `Test` только тогда, когда они являются интеграционными тестами для конкретных живых классов. Очень часто это не так - вот почему они и являются интеграционными тестами. Они могут интегрировать и тестировать несколько классов вместе. В этом случае я помещаю их в отдельный пакет и даю им произвольные имена, которые не совпадают с именами живых классов.

</code></pre></div></div><p>src/ main/ java/ foo/ Phrases.java Greetings.java test/ java/ foo/ it/ SimpleGuessingITCase.java PhrasesTest.java GreetingsTest.java GreetingsITCase.java ```</p><p>Здесь <code class="language-plaintext highlighter-rouge">GreetingsITCase.java</code> является интеграционным тестом для <code class="language-plaintext highlighter-rouge">Greetings.java</code>, тогда как <code class="language-plaintext highlighter-rouge">SimpleGuessingITCase.java</code> является интеграционным тестом для ни одного конкретного класса. Очевидно, пакет <code class="language-plaintext highlighter-rouge">foo.it</code> существует только в тестах и отсутствует в <code class="language-plaintext highlighter-rouge">src/main/java</code>.</p><p><br /></p><p>Таким образом, есть первое правило: тестовый класс может содержать только методы, помеченные аннотацией <code class="language-plaintext highlighter-rouge">@Test</code> (в случае Java).</p><p>Затем идет второе правило: пакет с тестами может содержать только классы с суффиксами <code class="language-plaintext highlighter-rouge">Test</code> или <code class="language-plaintext highlighter-rouge">ITCase</code>, которые отображаются один к одному на живые классы и ничего больше.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/31 on 2023-08-29 at 16:58</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?91e21ef9338"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
