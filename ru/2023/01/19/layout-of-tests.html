<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="On the Layout of Tests"/> <meta name="twitter:description" property="og:description" content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2023/01/19/layout-of-tests.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?cae138695db"/> <link rel="apple-touch-icon" href="/favicon.ico?cae138695db"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?cae138695db"/> <link rel="stylesheet" href="/css/icons.css?cae138695db"/> <link rel="canonical" href="https://www.yegor256.com/ru/2023/01/19/layout-of-tests.html" /> <title>On the Layout of Tests</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;385</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">On the Layout of Tests</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2023/01/19/layout-of-tests.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>Я не знаю, на каком языке программирования вы работаете, но мой опыт последней разработки на Java, Ruby, JavaScript, PHP, Python, C++ и Rust говорит мне, что принцип, к которому я попытаюсь вас убедить придерживаться, универсален для всех языков. Речь идет о названии файлов с тестами. Вам это может показаться вопросом малой важности, но позвольте мне попробовать показать, что это не так. Как вы называете ваши файлы с классами тестов? Сколько из них вы создаете в каталоге src/test/java? Где вы размещаете класс, который используется только в тесте, но сам по себе не является тестом? На большинство этих вопросов большинство из вас ответит “Как получится!” Итак, давайте попробуем найти лучший ответ.</p><p>Основная цель моих модульных тестов - помочь мне программировать. Они являются <a href="">защитной сеткой</a>, которая ловит меня, когда я допускаю ошибку. Например, предположим, что я возвращаюсь назад и редактирую несколько файлов, которые редактировал несколько лет назад, и, конечно же, на этот раз я делаю это неправильно. Затем я запускаю все 500 модульных тестов в проекте и… десять из них становятся красными. Обратите внимание, я не говорю “провалено”, потому что, подобно защитной сетке вокруг здания, проваленные тесты - это тесты, которые не поймали падающий молоток и не обнаружили только что появившийся баг. Таким образом, 490 из них <em>провалились</em>, но десять из них <em>прошли</em>.</p><h2 id="assertions">Assertions</h2><p>Затем я почесал затылок и задумался: что именно я сделал не так? Какой файл я испортил? Я только что изменил несколько десятков строк кода. Где именно была ошибка? Чтобы выяснить это, я прочитал вывод тестов. Я ожидаю, что сообщения, которые они выводят в консоль, будут достаточно описательными, чтобы помочь мне понять проблему. Я не хочу откатывать все свои изменения и начинать с нуля, верно? Я хочу быстро перейти к строке с ошибкой, исправить ее, перезапустить все 500 тестов, увидеть, что все они успешно пройдены, зафиксировать свои изменения и закончить на сегодня.</p><p>Не нужно говорить, что подробные сообщения о проверках тестов и правильное называние методов тестирования являются рецептом успеха. Рассмотрим простой объект Phrases, в котором мы добавляем несколько английских фраз, и он магическим образом понимает, какие из них являются приветствиями (очевидно, с использованием ML). Для такого класса этот тест на Java/JUnit5 был бы очень плохим:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>

<span class="nd">@Test</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">()</span> <span class="o">{</span> <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span> <span class="k">assert</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span> <span class="o">}</span> <span class="err">```</span>

<span class="no">В</span> <span class="n">то</span> <span class="n">время</span> <span class="n">как</span> <span class="n">этот</span> <span class="n">тест</span> <span class="n">намного</span> <span class="n">лучше</span> <span class="n">благодаря</span> <span class="n">утверждениям</span> <span class="o">[</span><span class="nc">Hamcrest</span><span class="o">](</span><span class="nl">https:</span><span class="c1">//www.hamcrest.org) (как называть методы теста --- отдельная история, подробно объясненная [здесь](https://stackoverflow.com/questions/155436/)):</span>

<span class="err">```</span><span class="n">java</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">equalTo</span><span class="o">;</span>

<span class="nd">@Test</span> <span class="kt">void</span> <span class="nf">countsSimpleGreetings</span><span class="o">()</span> <span class="o">{</span> <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span> <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span> <span class="n">assertThat</span><span class="o">(</span> <span class="s">"Total count of greetings"</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">);</span> <span class="o">}</span> <span class="err">```</span>

<span class="nc">Первый</span> <span class="n">отрывок</span> <span class="n">выведет</span> <span class="n">довольно</span> <span class="n">непонятное</span> <span class="n">сообщение</span> <span class="n">об</span> <span class="n">ошибке</span><span class="o">,</span> <span class="n">тогда</span> <span class="n">как</span> <span class="n">второй</span> <span class="n">мне</span> <span class="n">очень</span> <span class="n">поможет</span> <span class="n">в</span> <span class="n">борьбе</span> <span class="n">с</span> <span class="n">только</span> <span class="n">что</span> <span class="n">созданной</span> <span class="nl">ошибкой:</span> <span class="n">сообщение</span> <span class="n">будет</span> <span class="n">самоочевидным</span><span class="o">.</span> <span class="no">Я</span> <span class="n">быстро</span> <span class="n">пойму</span><span class="o">,</span> <span class="n">в</span> <span class="n">чем</span> <span class="n">проблема</span><span class="o">.</span>

<span class="err">##</span> <span class="nc">Test</span> <span class="nc">Classes</span>

<span class="nc">Описательные</span> <span class="n">сообщения</span> <span class="n">помогут</span> <span class="n">мне</span> <span class="n">понять</span><span class="o">,</span> <span class="n">в</span> <span class="n">чем</span> <span class="n">проблема</span><span class="o">.</span> <span class="nc">Однако</span> <span class="n">я</span> <span class="n">узнаю</span> <span class="o">*</span><span class="n">где</span><span class="o">*</span> <span class="n">находится</span> <span class="n">проблема</span><span class="o">?</span> <span class="no">В</span> <span class="n">каком</span> <span class="n">классе</span> <span class="nc">Java</span><span class="o">?</span> <span class="nc">Не</span> <span class="n">совсем</span><span class="o">.</span> <span class="nc">Она</span> <span class="n">находится</span> <span class="n">в</span> <span class="err">`</span><span class="nc">Phrases</span><span class="o">.</span><span class="na">java</span><span class="err">`</span> <span class="n">или</span><span class="o">,</span> <span class="n">возможно</span><span class="o">,</span> <span class="n">в</span> <span class="err">`</span><span class="nc">Greetings</span><span class="o">.</span><span class="na">java</span><span class="err">`</span><span class="o">,</span> <span class="n">который</span> <span class="n">возвращает</span> <span class="err">`</span><span class="nc">Phrases</span><span class="o">.</span><span class="na">greetings</span><span class="o">()</span><span class="err">`</span><span class="o">?</span> <span class="no">Я</span> <span class="n">могу</span> <span class="n">получить</span> <span class="n">эту</span> <span class="n">информацию</span> <span class="n">только</span> <span class="n">из</span> <span class="o">*</span><span class="n">имени</span><span class="o">*</span> <span class="n">тестового</span> <span class="n">класса</span><span class="o">.</span> <span class="nc">Если</span> <span class="n">он</span> <span class="n">называется</span> <span class="err">`</span><span class="nc">PhrasesTest</span><span class="o">.</span><span class="na">java</span><span class="err">`</span> <span class="o">-</span> <span class="n">все</span> <span class="n">ошибки</span><span class="o">,</span> <span class="n">которые</span> <span class="n">он</span> <span class="n">находит</span><span class="o">,</span> <span class="o">*</span><span class="n">скорее</span> <span class="n">всего</span><span class="o">*</span> <span class="n">находятся</span> <span class="n">в</span> <span class="err">`</span><span class="nc">Phrases</span><span class="o">.</span><span class="na">java</span><span class="err">`</span><span class="o">.</span> <span class="nc">Если</span> <span class="n">он</span> <span class="n">называется</span> <span class="err">`</span><span class="nc">GreetingsTest</span><span class="o">.</span><span class="na">java</span><span class="err">`</span> <span class="o">-</span> <span class="n">ну</span><span class="o">,</span> <span class="n">вы</span> <span class="n">понимаете</span> <span class="n">идею</span><span class="o">.</span>

<span class="nc">Моя</span> <span class="n">точка</span> <span class="n">зрения</span> <span class="n">заключается</span> <span class="n">в</span> <span class="n">том</span><span class="o">,</span> <span class="n">что</span> <span class="n">название</span> <span class="n">тестового</span> <span class="n">класса</span> <span class="o">-</span> <span class="n">это</span> <span class="n">не</span> <span class="n">просто</span> <span class="n">название</span><span class="o">.</span> <span class="nc">Это</span> <span class="n">инструкция</span> <span class="n">для</span> <span class="nl">программиста:</span> <span class="s">"Посмотри в файл исходного кода, имя которого можно получить из моего имени, удалив суффикс `Test`"</span><span class="o">.</span> <span class="nc">Если</span> <span class="n">я</span> <span class="n">пытаюсь</span> <span class="n">следовать</span> <span class="n">этой</span> <span class="n">инструкции</span> <span class="n">и</span> <span class="n">она</span> <span class="n">никуда</span> <span class="n">не</span> <span class="n">ведет</span><span class="o">,</span> <span class="n">я</span> <span class="n">очень</span> <span class="n">расстраиваюсь</span><span class="o">,</span> <span class="n">особенно</span> <span class="n">если</span> <span class="n">проект</span> <span class="n">не</span> <span class="n">мой</span><span class="o">.</span> <span class="no">Я</span> <span class="n">не</span> <span class="n">могу</span> <span class="n">получить</span> <span class="n">необходимую</span> <span class="n">информацию</span> <span class="n">ни</span> <span class="n">откуда</span> <span class="n">больше</span><span class="o">.</span> <span class="nc">Название</span> <span class="n">тестового</span> <span class="n">класса</span> <span class="o">-</span> <span class="n">моя</span> <span class="n">последняя</span> <span class="n">надежда</span><span class="o">.</span>

<span class="err">##</span> <span class="nc">Very</span> <span class="nc">Long</span> <span class="nc">Test</span> <span class="nc">Classes</span>

<span class="nc">Что</span> <span class="n">если</span> <span class="n">тестовый</span> <span class="n">класс</span> <span class="n">становится</span> <span class="n">слишком</span> <span class="n">длинным</span><span class="o">?</span> <span class="no">В</span> <span class="n">нем</span> <span class="n">может</span> <span class="n">быть</span> <span class="n">несколько</span> <span class="n">десятков</span> <span class="n">или</span> <span class="n">более</span> <span class="n">тестовых</span> <span class="n">методов</span><span class="o">.</span> <span class="nc">Мы</span> <span class="n">не</span> <span class="n">хотим</span><span class="o">,</span> <span class="n">чтобы</span> <span class="n">класс</span> <span class="n">был</span> <span class="n">слишком</span> <span class="n">большим</span><span class="o">,</span> <span class="n">верно</span><span class="o">?</span> <span class="nc">Неверно</span><span class="o">!</span> <span class="nc">Тестовый</span> <span class="n">класс</span> <span class="n">не</span> <span class="n">является</span> <span class="n">классом</span><span class="o">.</span> <span class="nc">Он</span> <span class="n">даже</span> <span class="n">не</span> <span class="n">является</span> <span class="n">утилитарным</span> <span class="n">классом</span><span class="o">.</span> <span class="nc">Это</span> <span class="n">контейнер</span> <span class="n">для</span> <span class="n">тестовых</span> <span class="n">сценариев</span><span class="o">.</span> <span class="nc">Он</span> <span class="n">называется</span> <span class="n">классом</span><span class="o">,</span> <span class="n">потому</span> <span class="n">что</span> <span class="n">в</span> <span class="nc">Java</span> <span class="o">(</span><span class="n">и</span> <span class="n">многих</span> <span class="n">других</span> <span class="n">языках</span><span class="o">)</span> <span class="n">нет</span> <span class="n">альтернативных</span> <span class="n">инструментов</span> <span class="n">организации</span> <span class="n">кода</span><span class="o">.</span> <span class="nc">Поэтому</span> <span class="n">не</span> <span class="n">беспокойтесь</span> <span class="n">о</span> <span class="n">том</span><span class="o">,</span> <span class="n">что</span> <span class="n">ваши</span> <span class="n">тестовые</span> <span class="n">классы</span> <span class="n">становятся</span> <span class="n">чрезмерно</span> <span class="n">длинными</span><span class="o">.</span> <span class="mi">5000</span> <span class="n">строк</span> <span class="n">кода</span> <span class="n">в</span> <span class="n">тестовом</span> <span class="n">классе</span> <span class="n">совсем</span> <span class="o">*</span><span class="n">не</span> <span class="n">является</span> <span class="n">проблемой</span><span class="o">*.</span> <span class="nc">Еще</span> <span class="n">раз</span><span class="o">,</span> <span class="n">потому</span> <span class="n">что</span> <span class="n">это</span> <span class="n">не</span> <span class="n">класс</span><span class="o">,</span> <span class="n">это</span> <span class="n">только</span> <span class="n">коллекция</span> <span class="n">тестовых</span> <span class="n">сценариев</span><span class="o">.</span>

<span class="err">##</span> <span class="nc">Test</span> <span class="nf">Prerequisites</span> <span class="o">(</span><span class="nc">Wrong</span> <span class="nc">Way</span><span class="o">)</span>

<span class="nc">Очень</span> <span class="n">часто</span> <span class="n">некоторые</span> <span class="n">классы</span> <span class="n">или</span> <span class="n">функции</span> <span class="n">не</span> <span class="n">являются</span> <span class="n">тестами</span><span class="o">,</span> <span class="n">но</span> <span class="n">должны</span> <span class="n">быть</span> <span class="n">общими</span> <span class="n">для</span> <span class="n">тестов</span><span class="o">.</span> <span class="o">(</span><span class="no">Я</span> <span class="n">уверен</span><span class="o">,</span> <span class="n">что</span> <span class="n">вы</span> <span class="n">знаете</span><span class="o">,</span> <span class="n">что</span> <span class="n">общие</span> <span class="n">тесты</span> <span class="o">-</span> <span class="n">это</span> <span class="o">[</span><span class="n">анти</span><span class="o">-</span><span class="n">паттерн</span><span class="o">]().</span> <span class="nc">Вы</span> <span class="n">знаете</span> <span class="n">об</span> <span class="n">этом</span><span class="o">?)</span> <span class="nc">Посмотрите</span><span class="o">,</span> <span class="n">как</span> <span class="n">я</span> <span class="n">переработал</span> <span class="n">модульный</span> <span class="n">тест</span> <span class="n">выше</span> <span class="o">(</span><span class="n">это</span> <span class="n">совсем</span> <span class="n">неэлегантно</span><span class="o">,</span> <span class="n">но</span> <span class="n">потерпите</span> <span class="n">меня</span> <span class="n">немного</span><span class="o">!).</span>

</code></pre></div></div><p>class PhrasesTest { @Test void countsSimpleGreetings() { Phrases p = new Phrases(); prepare(p); assertThat( “Total count of greetings”, p.greetings().count(), equalTo(1) ); } private static void prepare(Phrases p) { p.add(“Hello, world!”); p.add(“London is a capital of Great Britain”); } }</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Здесь, в закрытом методе `prepare(),` у меня есть удобный конструктор объекта класса `Phrases.` Этот конструктор может быть полезен для других тестов, таких как `GreetingsTest.` Я не хочу копировать его из `PhrasesTest` в `GreetingsTest.` Вместо этого, я хочу поместить его где-то, где он может быть повторно использован. Это будет правильное место для него (`foo` - это пакет Java, к которому относятся все наши классы).

</code></pre></div></div><p>src/ main/ java/ foo/ Phrases.java Greetings.java test/ java/ foo/ support/ FooUtils.java PhrasesTest.java GreetingsTest.java</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Статический метод `FooUtils.prepare()` теперь находится в утилитном классе `FooUtils` (ужасный [анти-паттерн]()), который находится в пакете `foo.support`. Но обратите внимание, не в пакете `foo`, а в подпакете, который не имеет аналога в блоке живого кода: в директории `src/main/java/foo/support` нет. Это ясное сообщение программисту, который столкнется с этим репозиторием через несколько лет: все классы, которые находятся в `foo.support`, предназначены только для тестового конвейера и сами по себе не являются тестами.

## Test Prerequisites (Right Way)

Как [вы знаете](), утилитарные классы и [приватные статические методы]() являются элементами императивного программирования. В объектно-ориентированном мире есть лучшие альтернативы. Особенно JUnit5 предлагает довольно элегантные механизмы для создания предварительных условий для тестов: [расширения тестов](https://junit.org/junit5/docs/current/user-guide/#extensions-registration). Все, что нужно для выполнения тестового метода, мы предоставляем через его параметры, которые создаются расширениями, например:

```java
import org.junit.jupiter.api.extension.*;

class PhrasesExtension implements ParameterResolver { @Override public boolean supportsParameter( ParameterContext pctx, ExtensionContext ectx) { return pctx.getParameter().getType() == Phrases.class; } @Override public Object resolveParameter( ParameterContext pctx, ExtensionContext ectx) { Phrases p = new Phrases(); p.add("Hello, world!"); p.add("London is a capital of Great Britain"); return p; } } ```

Then, the test will look like this:

```java
import org.junit.jupiter.api.extension.ExtendWith;

@ExtendWith(PhrasesExtension.class) class PhrasesTest { @Test void countsSimpleGreetings(Phrases p) { assertThat( "Total count of greetings", p.greetings().count(), equalTo(1) ); } } ```

Теперь тест и его предварительные условия находятся в двух разных местах и не связаны так тесно, как раньше. Более того, предварительные условия могут быть легко повторно использованы. Волшебная аннотация `@ExtendWith` может быть применена к другим тестам. Реализация `PhrasesExtension` может стать умнее: она может начать обращать внимание не только на тип аргумента метода тестирования, но и на пользовательскую аннотацию, прикрепленную к нему (так работает [`@TempDir`](https://junit.org/junit5/docs/5.4.1/api/org/junit/jupiter/api/io/TempDir.html)).

## Fake Objects (Best Way)

Несмотря на красоту расширений JUnit, я не считаю, что они являются лучшим способом разделения предварительных требований от методов тестирования. Расширения JUnit все еще довольно связаны... не с методами тестирования, а со всем набором тестов проекта. Если вы решите использовать их в другом месте, в другом проекте, вы не сможете сделать это.

Кроме того, если вы решите проверить свои предварительные условия, вы не сможете сделать это элегантно. Конечно, вы можете написать для них тесты в том же каталоге, но в этом случае вы нарушите принцип: один тест для одного живого класса.

Решение заключается в использовании [фиктивных объектов](). Они находятся вместе с другими активными объектами, но имеют особое "фиктивное" поведение, например (кстати, я [не люблю фабрики](), но в данном случае это нормально):

</code></pre></div></div><p>class FactoryOfPhrases { public Phrases aboutLondon() { Phrases p = new Phrases(); p.add(“Hello, world!”); p.add(“London is a capital of Great Britain”); return p; } }</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Then, the test will look like this:

</code></pre></div></div><p>class PhrasesTest { @Test void countsSimpleGreetings() { assertThat( “Total count of greetings”, new FactoryOfPhrases().aboutLondon() .greetings().count(), equalTo(1) ); } }</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Repository layout would look like this:

</code></pre></div></div><p>src/ main/ java/ foo/ FactoryOfPhrases.java Phrases.java Greetings.java test/ java/ foo/ FactoryOfPhrasesTest.java PhrasesTest.java GreetingsTest.java</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Обратите внимание на тест `FactoryOfPhrasesTest.` Он тестирует "фальшивый" объект `FactoryOfPhrases,` который является частью коллекции живых классов. Фабрика фраз поставляется вместе со всеми остальными классами. Поэтому ее можно использовать другими проектами не только для тестовых целей.

В общем, как правило, я предлагаю сохранять тестовые классы в чистом виде: в них должны присутствовать только тестовые методы. Никаких атрибутов и, конечно же, никаких статических приватных методов. Все, что является предпосылкой, должно быть "фейковым" объектом.

## Integration Tests

В мире Maven существуют классы модульного тестирования (с суффиксом `Test`) и классы интеграционного тестирования (с суффиксом `ITCase`). Разница между ними огромна. В то время как оба компилируются в фазе `test-compile` тем же плагином `maven-compiler-plugin`, они не выполняются вместе. Вместо этого модульные тесты выполняются на фазе `test`. Сборка сразу же завершается с ошибкой, если хотя бы один модульный тест не проходит. Это довольно простой подход, который похож на другие средства автоматизации сборки.

Integration tests are executed in four steps (these are the names of Maven phases):

</code></pre></div></div><p>pre-integration-test integration-test post-integration-test verify</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Сначала ресурсы, необходимые для интеграционного тестирования, получаются на этапе `pre-integration-test`. Например, может быть запущен тестовый экземпляр базы данных MySQL. Затем тесты с использованием `ITCase` выполняются на этапе «integration-test». Результат их выполнения игнорируется на данный момент, но только записывается в файл. Затем ресурсы освобождаются на этапе `post-integration-test`. Например, сервер MySQL закрывается. Наконец, на этапе `verify` результаты тестов проверяются, и сборка завершается с ошибкой, если некоторые из них не прошли успешно.

Я храню файлы `ITCase` вместе с файлами `Test` только тогда, когда они являются интеграционными тестами для конкретных рабочих классов. Очень часто это не так — вот почему они и называются интеграционными тестами. Они могут интегрировать и тестировать несколько классов одновременно. В этом случае я помещаю их в отдельный пакет и даю им произвольные имена, которые не совпадают с именами рабочих классов.

</code></pre></div></div><p>src/ main/ java/ foo/ Phrases.java Greetings.java test/ java/ foo/ it/ SimpleGuessingITCase.java PhrasesTest.java GreetingsTest.java GreetingsITCase.java ```</p><p>Здесь <code class="language-plaintext highlighter-rouge">GreetingsITCase.java</code> - это интеграционный тест для <code class="language-plaintext highlighter-rouge">Greetings.java</code>, в то время как <code class="language-plaintext highlighter-rouge">SimpleGuessingITCase.java</code> - интеграционный тест без привязки к конкретному классу. Очевидно, что пакет <code class="language-plaintext highlighter-rouge">foo.it</code> существует только в тестах и отсутствует в <code class="language-plaintext highlighter-rouge">src/main/java</code>.</p><p><br /></p><p>Thus, there is the first rule: a test class may only have methods annotated with <code class="language-plaintext highlighter-rouge">@Test</code> (in the case of Java).</p><p>Затем есть второе правило: пакет с тестами может содержать только классы с суффиксами <code class="language-plaintext highlighter-rouge">Test</code> или <code class="language-plaintext highlighter-rouge">ITCase</code>, которые однозначно соответствуют живым классам и не содержат ничего другого.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/001 on 2023-08-23 at 10:45</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?cae138695db"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
