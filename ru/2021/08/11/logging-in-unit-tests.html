<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Logging inside unit tests is a common practice, but a dangerous one, since it takes important knowledge away from the repository." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Logging in Unit Tests, a Bad Practice"/> <meta name="twitter:description" property="og:description" content="Logging inside unit tests is a common practice, but a dangerous one, since it takes important knowledge away from the repository."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2021/08/11/logging-in-unit-tests.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?278749a84ec"/> <link rel="apple-touch-icon" href="/favicon.ico?278749a84ec"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?278749a84ec"/> <link rel="stylesheet" href="/css/icons.css?278749a84ec"/> <link rel="canonical" href="https://www.yegor256.com/ru/2021/08/11/logging-in-unit-tests.html" /> <title>Logging in Unit Tests, a Bad Practice</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;387</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Logging in Unit Tests, a Bad Practice</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2021/08/11/logging-in-unit-tests.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>Логирование - неизбежная часть отладки. Ну, по крайней мере в современных языках программирования и архитектурах высокого уровня. Тридцать лет назад, в ассемблере, этого не было, но сейчас это так. Иногда мы отслеживаем переменные, но редко. Чаще всего мы просто выводим их на консоль. Более того, мы не просто выводим их с помощью <code class="language-plaintext highlighter-rouge">println</code> или чего-либо подобного для вывода на консоль; вместо этого мы отправляем сообщения в <a href="https://en.wikipedia.org/wiki/Java_logging_framework">систему логирования</a>, которая работает с консолью или любыми другими местами для логирования, например, файлами. Преимущество таких систем заключается в том, что нам не нужно удалять логирование после завершения отладки - мы просто настраиваем систему так, чтобы подавлять все сообщения уровня отладки в производственной среде. Некоторое логирование может происходить внутри модульных тестов. Оставляем ли мы их там или, может быть, нет?</p><p>Вот пример (это упрощение реального модульного теста в <a href="https://github.com/polystat/polystat/blob/0.0.1/src/test/java/org/polystat/far/CalcTest.java">CalcTest.java</a> из <a href="https://www.polystat.org">Polystat</a>, статического анализатора, над которым мы работаем в данный момент).</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import com.jcabi.log.Logger;
import com.jcabi.xml.XML;
import org.hamcrest.MatcherAssert;
import org.hamcrest.Matchers;
import org.junit.jupiter.api.Test;
public final class FooTest {
  @Test
  public void buildsSimpleXml() {
    final XML xml = new Foo().build();
    Logger.debug(this, "This is the XML:\n%s", xml.toString());
    MatcherAssert.assertThat(
      xml,
      Matchers.notNullValue()
    );
  }
}
</code></pre></div></div><p>Это Java, и я использую <a href="https://junit.org/junit5/">JUnit5</a>+<a href="http://hamcrest.org/">Hamcrest</a> вместе с моей собственной системой логирования <a href="https://log.jcabi.com">jcabi-log</a>, которая является декоратором <a href="http://www.slf4j.org/">Slf4j</a>, использующим <a href="https://logging.apache.org/log4j/2.x/">Log4j</a> для вывода на консоль.</p><p>Что здесь происходит? Есть класс <code class="language-plaintext highlighter-rouge">Foo</code> с методом <code class="language-plaintext highlighter-rouge">build()</code>, который создает XML-документ (я использую библиотеку <a href="https://xml.jcabi.com">jcabi-xml</a>, которая является декоратором <a href="https://docs.oracle.com/javase/8/docs/api/org/w3c/dom/package-summary.html">JDK DOM</a>). Затем, модульное тестирование выводит содержимое XML-документа в консоль и делает довольно глупое утверждение: документ не является NULL. Это глупо, потому что если бы он был NULL, то запись в журнал уже завершилась бы на вызове <code class="language-plaintext highlighter-rouge">.toString()</code>.</p><p>Я разработчик этого кода, поэтому я знаю, что происходило: мне было лень написать правильное утверждение, которое бы проверяло наличие правильных элементов внутри XML-документа. Я просто выводил его в консоль, <em>визуально</em> подтверждал его правильность и считал это завершением работы. Если бы у меня было больше времени, я бы написал намного лучший модульный тест (я только что внес <a href="https://github.com/polystat/polystat/issues/10">улучшения</a> в тесты Polystat).</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import com.jcabi.matchers.XhtmlMatchers;
import org.hamcrest.MatcherAssert;
import org.junit.jupiter.api.Test;
public final class FooTest {
  @Test
  public void buildsSimpleXml() {
    MatcherAssert.assertThat(
      XhtmlMatchers.xhtml(new Foo().build()),
      XhtmlMatchers.hasXPath("//foo")
    );
  }
}
</code></pre></div></div><p>Теперь XML-документ создается, а затем проверяется на наличие <code class="language-plaintext highlighter-rouge">//foo</code> <a href="https://ru.wikipedia.org/wiki/XPath">XPath</a>. Содержимое документа будет выведено в консоль только в случае неудачного утверждения. Если XML имеет требуемый XPath, в консоли ничего не будет выведено, что означает отсутствие ненужных данных для будущих разработчиков.</p><p>Более того, сейчас это <em>тест, состоящий из одного высказывания</em>, что само по себе является хорошей практикой.</p><p>Оглядываясь на свой опыт тестирования и журналирования, я считаю, что журналирование в модульных тестах - плохая идея. Иногда неизбежная, потому что мы ленивы или просто не имеем достаточно времени, но все равно плохая. Журналирование помогает нам визуально подтвердить правильность вывода, но оно отнимает этот знак от проекта. Те, кто будет работать с тестом позже, не будут знать, что мы видели там. Они увидят вывод на консоли, но не поймут, соответствует ли он все еще моим ожиданиям на момент написания.</p><p>Я бы сказал, что каждая строка журналирования в модульном тесте - это сообщение от его автора: “Я знаю что-то о данных, которые я вижу сейчас, но мне лень рассказывать вам об этом, вам просто нужно поверить мне, что они выглядят хорошо”.</p><p>Я предлагаю не оставлять такие сообщения в нашем коде.</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Do you print log messages from your unit tests?</p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1421723724638789632?ref_src=twsrc%5Etfw">August 1, 2021</a></blockquote> <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/35 on 2023-09-15 at 14:55</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?278749a84ec"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
