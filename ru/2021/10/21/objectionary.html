<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It is a platform-independent object repository, which hosts source code and validates its consistency on each modification." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Objectionary: Dictionary and Factory for EO Objects"/> <meta name="twitter:description" property="og:description" content="It is a platform-independent object repository, which hosts source code and validates its consistency on each modification."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/ru/2021/10/21/objectionary.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?fde5dc788ce"/> <link rel="apple-touch-icon" href="/favicon.ico?fde5dc788ce"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?fde5dc788ce"/> <link rel="stylesheet" href="/css/icons.css?fde5dc788ce"/> <link rel="canonical" href="https://www.yegor256.com/ru/2021/10/21/objectionary.html" /> <title>Objectionary: Dictionary and Factory for EO Objects</title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;390</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name headline mainEntityOfPage">Objectionary: Dictionary and Factory for EO Objects</h1></header> <article class="main" itemprop="articleBody" style="font-family: sans-serif; font-size: 0.9em; line-height: 1.2em;"><p style="color: #C42C00;">The following text is a <em>partial</em> translation of the <a href='https://www.yegor256.com/2021/10/21/objectionary.html'>original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:</p><p>Со времен Кернигана и Ритчи мы делим двоичный код в библиотеках. Вам нужно вывести некоторый текст с помощью <a href="https://en.wikipedia.org/wiki/Printf_format_string"><code class="language-plaintext highlighter-rouge">printf()</code></a> в C++? Вы получаете библиотеку <a href="https://en.wikipedia.org/wiki/Glibc">libc</a> с более чем <a href="https://stackoverflow.com/a/33188344/187141">700</a> другими функциями внутри. Вам нужно скопировать поток Java? Вы получаете <a href="https://commons.apache.org/proper/commons-io/">Apache Commons IO</a> с методом <a href="https://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/IOUtils.html#copy-java.io.InputStream-java.io.OutputStream-"><code class="language-plaintext highlighter-rouge">copy()</code></a> и еще <a href="https://commons.apache.org/proper/commons-io/apidocs/index.html">140</a> другими методами и классами. То же самое происходит во всех языках, с которыми я знаком, таких как Ruby, Python, JavaScript, PHP: вам нужен объект, класс, функция или метод - вы должны добавить всю библиотеку в свою сборку. Разве не было бы элегантнее иметь дело с отдельными объектами?</p><p>Идея не нова и не моя. Я получил ее из книги <a href="http://amzn.to/266oJr4">Object Thinking</a> Дэвида Уэста, где он предложил создать <em>Объектарий</em> (страница 306), “сочетание словаря и фабрики объектов”, с следующими характеристиками:</p><ul> <li><p>Общее количество объектов составляет менее 2000.</p></li> <li><p>Каждый объект является автономной исполняемой сущностью;</p></li> <li><p>Каждый объект имеет уникальный идентификатор (ID) и уникальный “адрес”.</p></li> <li><p>Объекты - это всего лишь коллекции объектов;</p></li> <li><p>Объекты требуют аппаратно-специфичных виртуальных машин для выполнения.</p></li></ul><p>Семнадцать лет спустя (книга была опубликована в 2004 году), мы реализовали идею поверх <a href="https://www.eolang.org">EO</a>, нашего нового языка программирования. Язык намеренно намного проще, чем Java или C++. Более или менее формальное описание можно прочитать <a href="https://arxiv.org/abs/2111.13384">здесь</a>.</p><p>Чтобы превратить программу на EO в исполняемую сущность и выпустить ее в <a href="https://www.objectionary.com">Objectionary</a>, необходимо пройти следующие обязательные шаги, предполагая, что в качестве целевой платформы используется JVM (шаги, отмеченные 🌵, реализованы нашим <a href="https://github.com/cqfn/eo">eo-maven-plugin</a>):</p><ul> <li><p><strong>Assemble</strong>🌵:</p></li> <li><p><strong>Parse</strong>🌵: <code class="language-plaintext highlighter-rouge">.eo</code> ➜ <code class="language-plaintext highlighter-rouge">.xmir</code> <strong>Разбор</strong>🌵: <code class="language-plaintext highlighter-rouge">.eo</code> ➜ <code class="language-plaintext highlighter-rouge">.xmir</code></p></li> <li><p><strong>Оптимизировать</strong>🌵: <code class="language-plaintext highlighter-rouge">.xmir</code> ➜ лучше <code class="language-plaintext highlighter-rouge">.xmir</code></p></li> <li><p><strong>Discover</strong>🌵: найти все иностранные псевдонимы</p></li> <li><p>“<strong>Pull</strong>🌵: <a href="https://github.com/yegor256/objectionary">скачать</a> внешние объекты <code class="language-plaintext highlighter-rouge">.eo</code>”</p></li> <li><p><strong>Разрешить</strong>🌵: <a href="https://search.maven.org/">скачать</a> и распаковать артефакты <code class="language-plaintext highlighter-rouge">.jar</code></p></li> <li><p><strong>Место</strong>🌵: переместите файлы артефакта <code class="language-plaintext highlighter-rouge">.class</code> в <code class="language-plaintext highlighter-rouge">target/classes/</code>.</p></li> <li><p><strong>Mark</strong>🌵: пометить исходные файлы <code class="language-plaintext highlighter-rouge">.eo</code>, найденные в <code class="language-plaintext highlighter-rouge">.jar</code>, как иностранные</p></li> <li><p>↑ Вернитесь к <strong>Parse</strong>, если некоторые файлы <code class="language-plaintext highlighter-rouge">.eo</code> все еще не были разобраны</p></li> <li><p><strong>Transpile</strong>🌵: <code class="language-plaintext highlighter-rouge">.xmir</code> ➜ <code class="language-plaintext highlighter-rouge">.java</code></p></li></ul><p><strong>Транспиляция</strong>🌵: <code class="language-plaintext highlighter-rouge">.xmir</code> ➜ <code class="language-plaintext highlighter-rouge">.java</code></p><ul> <li><p><strong>Assemble</strong>🌵: то же самое, что и выше, но для тестов</p></li> <li><p><strong>Компиляция</strong>: <code class="language-plaintext highlighter-rouge">.java</code> ➜ <code class="language-plaintext highlighter-rouge">.class</code></p></li> <li><p><strong>Тест</strong>: запустить все модульные тесты.</p></li> <li><p><strong>Unplace</strong>🌵: удаление файлов артефактов <code class="language-plaintext highlighter-rouge">.class</code>.</p></li> <li><p><strong>Unspile</strong>🌵: удалить автоматически сгенерированные файлы <code class="language-plaintext highlighter-rouge">.java</code></p></li> <li><p><strong>Копирование</strong>🌵: скопируйте файлы <code class="language-plaintext highlighter-rouge">.eo</code> внутрь <code class="language-plaintext highlighter-rouge">.jar</code> в папку <code class="language-plaintext highlighter-rouge">EO-SOURCES/</code>.</p></li> <li><p><strong>Развернуть</strong>: упаковать артефакт <code class="language-plaintext highlighter-rouge">.jar</code> и поместить его в Maven Central.</p></li> <li><p><strong>Push</strong>: отправить запрос на слияние в <a href="https://github.com/yegor256/objectionary">yegor256/objectionary</a></p></li> <li><p><strong>Слияние</strong>: мы тестируем и объединяем запрос на включение изменений</p></li></ul><p>Это итеративный процесс, который повторяется снова и снова, пока все необходимые объекты <code class="language-plaintext highlighter-rouge">.eo</code> не будут разобраны и их атомы не будут представлены в виде файлов <code class="language-plaintext highlighter-rouge">.class</code>. Затем все файлы <code class="language-plaintext highlighter-rouge">.xmir</code> переводятся в <code class="language-plaintext highlighter-rouge">.java</code> и затем компилируются в двоичные файлы <code class="language-plaintext highlighter-rouge">.class</code>. Затем они тестируются, упаковываются и развертываются в Maven Central. Затем они объединяются с веткой <code class="language-plaintext highlighter-rouge">master</code> <a href="https://www.objectionary.com">Objectionary</a> через pull-запрос.</p><p>Первая часть алгоритма может быть автоматизирована с помощью <a href="https://github.com/cqfn/eo">нашего плагина Maven</a>, просто поместив исходные файлы <code class="language-plaintext highlighter-rouge">.eo</code> в <code class="language-plaintext highlighter-rouge">src/main/eo/</code> и добавив это в <code class="language-plaintext highlighter-rouge">pom.xml</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.eolang&lt;/groupId&gt;
        &lt;artifactId&gt;eo-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;register&lt;/goal&gt;
              &lt;goal&gt;assemble&lt;/goal&gt;
              &lt;goal&gt;transpile&lt;/goal&gt;
              &lt;goal&gt;copy&lt;/goal&gt;
              &lt;goal&gt;unplace&lt;/goal&gt;
              &lt;goal&gt;unspile&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
    [...]
  &lt;/build&gt;
  [...]
&lt;/project&gt;
</code></pre></div></div><p>Цель <code class="language-plaintext highlighter-rouge">register</code> сканирует каталог <code class="language-plaintext highlighter-rouge">src/main/eo/</code>, находит все исходные файлы с расширением <code class="language-plaintext highlighter-rouge">.eo</code> и “регистрирует” их в специальном CSV-каталоге <code class="language-plaintext highlighter-rouge">target/eo-foreigns.csv</code>. Затем цель <code class="language-plaintext highlighter-rouge">assemble</code> вызывает следующие цели: <code class="language-plaintext highlighter-rouge">parse</code>, <code class="language-plaintext highlighter-rouge">optimize</code>, <code class="language-plaintext highlighter-rouge">discover</code>, <code class="language-plaintext highlighter-rouge">pull</code> и <code class="language-plaintext highlighter-rouge">resolve</code>. Все эти цели используют CSV-каталог при выполнении операций разбора, оптимизации, извлечения и других.</p><p>Когда все они завершены, <code class="language-plaintext highlighter-rouge">assemble</code> проверяет каталог: есть ли еще файлы с расширением <code class="language-plaintext highlighter-rouge">.eo</code>, требующие разбора? Если да, то начинается еще один цикл, снова с разбора. Когда все файлы <code class="language-plaintext highlighter-rouge">.eo</code> разобраны, выполняется цель <code class="language-plaintext highlighter-rouge">transpile</code>, которая преобразует файлы <code class="language-plaintext highlighter-rouge">.xmir</code> в <code class="language-plaintext highlighter-rouge">.java</code> и помещает их в <code class="language-plaintext highlighter-rouge">target/generated-sources</code>. Остальное выполняется стандартным <a href="https://maven.apache.org/plugins/maven-compiler-plugin/"><code class="language-plaintext highlighter-rouge">maven-compiler-plugin</code></a>.</p><p>Давайте подробно обсудим каждый шаг.</p><h2 id="parse-">Parse 🌵</h2><p>Скажем, это исходный код на <code class="language-plaintext highlighter-rouge">.eo</code> находится в <code class="language-plaintext highlighter-rouge">src/main/eo/hello.eo</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+alias org.eolang.io.stdout
[] &gt; hello
  "Jeff" &gt; user
  stdout &gt; @
    "Hello, %s!"
    user
</code></pre></div></div><p>Он будет преобразован в XMIR (XML Intermediate Representation):</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;program&gt;
  &lt;o name="hello" line="1"&gt;
    &lt;o name="user" data="string" line="2"&gt;Jeff&lt;/o&gt;
    &lt;o name="@" base="stdout" line="3"&gt;
      &lt;o data="string" line="4"&gt;Hello, %s!&lt;/o&gt;
      &lt;o base="user" line="5"/&gt;
    &lt;/o&gt;
  &lt;/o&gt;
&lt;/program&gt;
</code></pre></div></div><p>Если вы задаетесь вопросом, что означает этот XML, прочитайте <a href="https://arxiv.org/abs/2111.13384">этот документ</a>: там есть раздел о XMIR.</p><h2 id="optimize-">Optimize 🌵</h2><p>На этом этапе XMIR, созданный парсером, проходит через множество преобразований XSL, иногда получая дополнительные элементы и атрибуты. Наш пример XMIR может получить новый атрибут <code class="language-plaintext highlighter-rouge">@ref</code>, указывающий на ссылку на объект <code class="language-plaintext highlighter-rouge">user</code> в строке, где был определен объект.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;program&gt;
  &lt;o name="hello" line="1"&gt;
    &lt;o name="user" data="string" line="2"&gt;Jeff&lt;/o&gt;
    &lt;o name="@" base="stdout" line="3"&gt;
      &lt;o data="string" line="4"&gt;Hello, %s!&lt;/o&gt;
      &lt;o base="user" line="5" ref="2"/&gt;
    &lt;/o&gt;
  &lt;/o&gt;
&lt;/program&gt;
</code></pre></div></div><p>Некоторые преобразования XSL могут проверять на наличие грамматических или семантических ошибок и добавлять новый элемент <code class="language-plaintext highlighter-rouge">&lt;errors/&gt;</code>, если что-то неправильно обнаружено. Таким образом, если разбор не обнаружил синтаксических ошибок, все остальные ошибки будут видны внутри документа XMIR, например, вот так:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;program&gt;
  &lt;errors&gt;
    &lt;error line=&gt;The program has no package&lt;/error&gt;
  &lt;/errors&gt;
  &lt;o name="hello" line="1"&gt;
    &lt;o name="user" data="string" line="2"&gt;Jeff&lt;/o&gt;
    &lt;o name="@" base="stdout" line="3"&gt;
      &lt;o data="string" line="4"&gt;Hello, %s!&lt;/o&gt;
      &lt;o base="user" line="5" ref="2"/&gt;
    &lt;/o&gt;
  &lt;/o&gt;
&lt;/program&gt;
</code></pre></div></div><p>Кстати, это не настоящая ошибка, я ее просто придумал.</p><h2 id="discover-">Discover 🌵</h2><p>На этом этапе мы выясняем, какие объекты являются «иностранными». В нашем примере объект <code class="language-plaintext highlighter-rouge">user</code> не является иностранным, так как он определен в коде, который у нас перед глазами, тогда как объект <code class="language-plaintext highlighter-rouge">stdout</code> здесь не определен, и поэтому он является иностранным.</p><p>Проходя через все файлы <code class="language-plaintext highlighter-rouge">.xmir</code>, мы легко можем определить, какой объект является иностранным, просто посмотрев на их имена. Как только мы видим ссылку на <code class="language-plaintext highlighter-rouge">org.eolang.io.stdout</code>, мы проверяем наличие файла <code class="language-plaintext highlighter-rouge">org/eolang/io/stdout.eo</code> в каталоге со всеми исходными файлами <code class="language-plaintext highlighter-rouge">.eo</code>. Если файла нет, мы заносим имя объекта в каталог CSV и объявляем его иностранным.</p><h2 id="pull">Pull</h2><p>Здесь мы просто пытаемся найти исходные коды файлов <code class="language-plaintext highlighter-rouge">.eo</code> для всех внешних объектов в Objectionary, просматривая его <a href="https://github.com/yegor256/objectionary">репозиторий GitHub</a>. Например, здесь мы бы нашли <a href="https://github.com/yegor256/objectionary/blob/master/objects/org/eolang/io/stdout.eo"><code class="language-plaintext highlighter-rouge">stdout.eo</code></a>. Мы находим их там и копируем на локальный диск.</p><p>Обратите внимание, мы копируем исходники. Не бинарные или скомпилированные документы XMIR, а исходники в формате <code class="language-plaintext highlighter-rouge">.eo</code>.</p><h2 id="resolve-">Resolve 🌵</h2><p>Вот как может выглядеть <a href="https://github.com/yegor256/objectionary/blob/master/objects/org/eolang/io/stdout.eo"><code class="language-plaintext highlighter-rouge">stdout.eo</code></a> после выполнения pull-запроса:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+package org.eolang.io
+rt jvm org.eolang:eo-runtime:0.10.2
[text] &gt; stdout /bool
</code></pre></div></div><p>Объект представляет собой <em>атом</em>. Это означает, что даже если у нас есть его исходный код, он не полон без куска платформо-специфичного бинарного кода. Атом - это объект, реализованный платформой выполнения, где выполняется программа EO (также известная как <a href="https://ru.wikipedia.org/wiki/Foreign_function_interface">механизм FFI</a>). Строка, начинающаяся с <code class="language-plaintext highlighter-rouge">+rt</code> (runtime) объясняет, где получить код выполнения. Часть <code class="language-plaintext highlighter-rouge">jvm</code> - это имя выполнения.</p><p>Мы переходим на <a href="https://search.maven.org/">Maven Central</a>, находим там артефакт <a href="https://search.maven.org/artifact/org.eolang/eo-runtime"><code class="language-plaintext highlighter-rouge">org.eolang:eo-runtime:0.10.2</code></a> и распаковываем его (в конце концов, это zip-архив с файлами <code class="language-plaintext highlighter-rouge">.class</code>).</p><p>Кстати, программа может содержать несколько мета-инструкций <code class="language-plaintext highlighter-rouge">+rt</code>, например:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+package org.eolang.io
+rt jvm org.eolang:eo-runtime:0.10.2
+rt ruby eo-core:0.5.8
+rt python eo-basics:0.0.3
[text] &gt; stdout /bool
</code></pre></div></div><p>Здесь три среды выполнения будут знать, откуда получить отсутствующий код для атома <code class="language-plaintext highlighter-rouge">stdout</code>: EO➝Java обратится к <a href="https://search.maven.org/">Maven Central</a> для получения JAR-артефакта, EO➝Ruby попытается найти гем с именем <code class="language-plaintext highlighter-rouge">eo-core</code> и версией <code class="language-plaintext highlighter-rouge">0.5.8</code> в <a href="https://rubygems.org/">RubyGems</a>, тогда как EO➝Python попытается найти пакет <code class="language-plaintext highlighter-rouge">eo-basics</code> с версией <code class="language-plaintext highlighter-rouge">0.0.3</code> в <a href="https://pypi.org/">PyPi</a>.</p><h2 id="place-">Place 🌵</h2><p>Затем мы помещаем все файлы <code class="language-plaintext highlighter-rouge">.class</code>, найденные в распакованном JAR-файле, в каталог <code class="language-plaintext highlighter-rouge">target/classes</code>. Мы делаем это для того, чтобы помочь плагину Maven Compiler Plugin найти их в пути классов.</p><h2 id="mark-">Mark 🌵</h2><p>В каждом прибывшем JAR-файле мы можем найти исходные файлы <code class="language-plaintext highlighter-rouge">.eo</code>. Они представляют собой программы, которые были в classpath этого JAR-файла во время его создания. Мы также считаем их чужими объектами и добавляем в CSV-каталог.</p><h2 id="transpile-">Transpile 🌵</h2><p>Когда все иностранные объекты, зарегистрированные в каталоге, загружены, скомпилированы и оптимизированы, мы готовы начать <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler"><em>транспиляцию</em></a>. Вместо того чтобы компилировать XMIR непосредственно в байт-код, мы транспилируем его в <code class="language-plaintext highlighter-rouge">.java</code> и позволяем компилятору Java выполнить задачу по генерации байт-кода.</p><p>Мы считаем, что транспиляция в Java по сравнению с компиляцией в байт-код имеет несколько преимуществ:</p><ul> <li><p>Выходной код легче читать и отлаживать.</p></li> <li><p>“Мощность оптимизации существующих компиляторов используется повторно.”</p></li> <li><p>Сложность транспилятора ниже, чем у компилятора.</p></li> <li><p>Переносимость выходного кода выше.</p></li></ul><p>У нас уже есть два транспилятора EO➝Java: <a href="https://github.com/cqfn/eo">канонический</a> и <a href="https://github.com/polystat/hse-transpiler">тот</a>, который сделан <a href="https://www.hse.ru/en/">Университетом НИУ ВШЭ</a>. У нас также есть экспериментальный транспилятор EO➝Python <a href="https://github.com/polystat/eo2py">transpiler</a>, созданный студентами <a href="https://innopolis.university/en/">Университета Иннополиса</a>. Скорее всего, когда вы прочтете эту статью, будут доступны и другие транспиляторы.</p><p>Несмотря на то, что мы верим в транспиляцию, по-прежнему возможно создание компиляторов EO➝Bytecode, EO➝LLVM или EO➝x86. Вы можете попробовать!</p><h2 id="compile">Compile</h2><p>На данном этапе стандартный <a href="https://maven.apache.org/plugins/maven-compiler-plugin/">Maven Compiler Plugin</a> находит автоматически созданные файлы <code class="language-plaintext highlighter-rouge">.java</code> в <code class="language-plaintext highlighter-rouge">target/generated-sources</code> и преобразует их в файлы <code class="language-plaintext highlighter-rouge">.class</code>.</p><h2 id="unplace-">Unplace 🌵</h2><p>Здесь мы удаляем все файлы <code class="language-plaintext highlighter-rouge">.class</code>, распакованные из зависимостей. Это необходимо, чтобы избежать их упаковки в итоговый JAR-файл.</p><p>Мы выполняем размещение и затем отмену размещения просто потому, что плагин компилятора Maven <a href="https://stackoverflow.com/questions/3410548">не позволяет</a> нам расширять путь к классам во время выполнения. Если бы это было возможно, мы просто загрузили бы зависимости из Maven Central и добавили их в путь к классам, без распаковки, размещения и отмены размещения.</p><h2 id="unspile-">Unspile 🌵</h2><p>Здесь мы удаляем все файлы <code class="language-plaintext highlighter-rouge">.class</code> из директории <code class="language-plaintext highlighter-rouge">target/classes/</code>, которые были автоматически сгенерированы из файлов <code class="language-plaintext highlighter-rouge">.eo</code>. Мы не хотим включать бинарные файлы, которые могут быть сгенерированы из исходных файлов <code class="language-plaintext highlighter-rouge">.eo</code>. Мы хотим включить только файлы <code class="language-plaintext highlighter-rouge">.java</code>, которые представляют собой атомы.</p><h2 id="copy-">Copy 🌵</h2><p>На этом шаге мы берем все <code class="language-plaintext highlighter-rouge">.eo</code> исходники из <code class="language-plaintext highlighter-rouge">src/main/eo/</code> и копируем их в директорию <code class="language-plaintext highlighter-rouge">target/classes/EO-SOURCES/</code>. Позже они будут упакованы вместе с файлами <code class="language-plaintext highlighter-rouge">.class</code> в <code class="language-plaintext highlighter-rouge">.jar</code>, который будет размещен в Maven Central. При копировании мы заменяем <code class="language-plaintext highlighter-rouge">0.0.0</code> в версии runtime на текущую развертываемую версию. Взгляните на файл <a href="https://github.com/cqfn/eo/blob/master/eo-runtime/src/main/eo/org/eolang/io/stdout.eo"><code class="language-plaintext highlighter-rouge">stdout.eo</code></a> в его исходном репозитории.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+package org.eolang.io
+rt jvm org.eolang:eo-runtime:0.0.0
[text] &gt; stdout /bool
</code></pre></div></div><p>Версия на строке <code class="language-plaintext highlighter-rouge">+rt</code> - <code class="language-plaintext highlighter-rouge">0.0.0</code>. При копировании исходных файлов в JAR-файл этот текст заменяется.</p><p>Мотивация для отправки исходных файлов вместе с двоичными файлами заключается в следующем. Когда двоичные файлы атома компилируются из Java в байт-код, они остаются рядом с исходными файлами транспиляции. Они компилируются вместе. Кроме того, модульные тесты также зависят как от исходных файлов атома, так и от автоматически сгенерированных/транспилированных файлов. Мы хотим, чтобы будущие пользователи JAR-файла знали, какие исходные файлы мы использовали во время компиляции, чтобы, возможно, позволить им воспроизвести ее или, по крайней мере, знать, каковы были условия получения двоичных файлов.</p><p>С практической точки зрения, нам нужны эти исходные файлы в JAR-файле, чтобы позволить шагу <strong>Mark</strong> понять, какие объекты стоит вытягивать рядом с разрешенными атомами.</p><h2 id="deploy">Deploy</h2><p>Здесь мы упаковываем все из <code class="language-plaintext highlighter-rouge">target/classes/</code> в JAR-архив и размещаем его в Maven Central.</p><p>Я предлагаю также разместить исходные коды на GitHub Pages, чтобы пользователи могли видеть их в Интернете. Кроме того, это будет полезно позже, когда мы будем создавать запрос на включение в Objectionary. Посмотрите этот скрипт <a href="https://github.com/yegor256/eo-files/blob/master/.rultor.yml#L17-L31"><code class="language-plaintext highlighter-rouge">.rultor.yml</code></a> в одной из моих библиотек EO, он размещает исходные коды <code class="language-plaintext highlighter-rouge">.eo</code> на GitHub Pages, правильно заменяя маркеры версии <code class="language-plaintext highlighter-rouge">0.0.0</code> в них.</p><h2 id="push">Push</h2><p>Когда развертывание завершено и серверы CDN Maven Central обновляются, пришло время отправить pull-запрос в <a href="https://github.com/yegor256/objectionary">yegor256/objectionary</a>. Исходные файлы <code class="language-plaintext highlighter-rouge">.eo</code> объектов помещаются в <code class="language-plaintext highlighter-rouge">objects/</code>, а их модульные тесты - в <code class="language-plaintext highlighter-rouge">tests/</code>. Фактически, мы просто копируем <code class="language-plaintext highlighter-rouge">src/main/eo/</code> и <code class="language-plaintext highlighter-rouge">src/test/eo</code> туда. Но, стоп… одна важная деталь. В исходных файлах, как уже было сказано, у нас установлены версии <code class="language-plaintext highlighter-rouge">+rt</code> равные <code class="language-plaintext highlighter-rouge">0.0.0</code>. Здесь, при копировании в Objectionary, версии должны быть установлены на реальные числа.</p><h2 id="merge">Merge</h2><p>Когда поступает запрос на слияние, предварительно настроенное действие GitHub в репозитории <a href="https://github.com/yegor256/objectionary">yegor256/objectionary</a> транспилирует все исходные файлы <code class="language-plaintext highlighter-rouge">.eo</code> на все известные платформы и запускает все модульные тесты. Если все чисто, мы рассматриваем запрос на слияние и решаем, подходят ли предлагаемые объекты к уже существующим в Объекционарии.</p><p>После слияния запроса на слияние объекты становятся частью централизованного словаря всех объектов EO. Взгляните на <a href="https://github.com/yegor256/objectionary/pull/2">этот запрос на слияние</a>, где был добавлен новый объект в Объекционарий после развертывания его атома в Maven Central.</p><p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/36 on 2023-10-30 at 04:55</p></article></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2023</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?fde5dc788ce"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
